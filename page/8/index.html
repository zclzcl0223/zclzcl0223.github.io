<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=[object Object]"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', '[object Object]');
</script>
<!-- End Google Analytics -->

  
  <title>JourneyToCoding</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="Start of Something New">
<meta property="og:type" content="website">
<meta property="og:title" content="JourneyToCoding">
<meta property="og:url" content="https://zclzcl0223.github.io/page/8/index.html">
<meta property="og:site_name" content="JourneyToCoding">
<meta property="og:description" content="Start of Something New">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="ChaosTsang">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="JourneyToCoding" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/%5Bobject%20Object%5D">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">JourneyToCoding</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Code for fun</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/">home</a>
        
          <a class="main-nav-link" href="/about/">about</a>
        
          <a class="main-nav-link" href="/tags/">tags</a>
        
          <a class="main-nav-link" href="/categories/">categories</a>
        
          <a class="main-nav-link" href="/archives/">archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://zclzcl0223.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-SystemSecurityPermission" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/25/SystemSecurityPermission/" class="article-date">
  <time class="dt-published" datetime="2023-07-25T10:23:22.000Z" itemprop="datePublished">2023-07-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Tool/">Tool</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/25/SystemSecurityPermission/">System Security and Permissions</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <span id="more"></span>


<h1 id="用户"><a href="#用户" class="headerlink" title="用户"></a>用户</h1><p>计算机启动时的密码输入界面就是通常的用户登录界面。以什么用户登录计算机，我们就只能以该用户的身份创建文件、访问该用户能访问文件。每个Linux操作系统都会有一个超级用户<code>root</code>，<code>root</code>用户拥有对所有文件的访问权限，并且能够执行普通用户无法执行的“特权”命令。不过，Linux也为我们提供了除重新登陆外的切换用户身份的方式。</p>
<h2 id="su：Switch-User，以其他用户身份运行shell"><a href="#su：Switch-User，以其他用户身份运行shell" class="headerlink" title="su：Switch User，以其他用户身份运行shell"></a><code>su</code>：Switch User，以其他用户身份运行shell</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su [options] [-] [USER [arg]...]</span><br></pre></td></tr></table></figure>

<p><code>su</code>命令允许我们在正确输入目标用户的登录密码的情况下以该用户的身份启动shell。若<code>su</code>后面的用户选项为空，则会默认切换为<code>root</code>用户：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ su</span><br><span class="line">Password: </span><br><span class="line">[root@localhost Playground]<span class="comment"># exit</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line">[meme@localhost Playground]$ su bob</span><br><span class="line">Password: </span><br><span class="line">[bob@localhost Playground]$ <span class="built_in">exit</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line">[meme@localhost Playground]$ </span><br></pre></td></tr></table></figure>

<blockquote>
<p>输入<code>exit</code>后我们将退出目标用户并恢复原用户身份。</p>
</blockquote>
<p>若我们只是想以其他用户的身份执行一个命令，我们也可以使用<code>su -c &#39;command&#39;</code>来传递命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ su -c &#x27;ls&#x27;</span><br><span class="line">Password: </span><br><span class="line">foo.txt</span><br><span class="line">[meme@localhost Playground]$ </span><br></pre></td></tr></table></figure>

<p>执行完命令后，我们将立马返回原用户。需要注意的是，传递的命令必须用引号括起。</p>
<h2 id="sudo：以另一个用户身份执行命令"><a href="#sudo：以另一个用户身份执行命令" class="headerlink" title="sudo：以另一个用户身份执行命令"></a><code>sudo</code>：以另一个用户身份执行命令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo [<span class="built_in">command</span>]</span><br></pre></td></tr></table></figure>

<p><code>sudo</code>在一定程度上很像<code>su -c &#39;command&#39;</code>，都是使得我们能以其他用户的身份执行命令。但是<code>sudo</code>通常只用于执行<code>root</code>用户的命令，且能够执行的命令也只能由<code>root</code>用户配置，因而是一种比<code>su</code>更加安全可控的方式：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ sudo <span class="built_in">ls</span></span><br><span class="line">[sudo] password <span class="keyword">for</span> meme: </span><br><span class="line">foo.txt</span><br><span class="line">[meme@localhost Playground]$ </span><br></pre></td></tr></table></figure>

<blockquote>
<p>可用<code>sudo -l</code>查看所有<code>sudo</code>能够执行的命令（的库地址）。一次<code>sudo</code>后，系统会信任用户几分钟，使得后续的<code>sudo</code>不用再输入密码。</p>
</blockquote>
<h1 id="拥有者，组成员，其他人"><a href="#拥有者，组成员，其他人" class="headerlink" title="拥有者，组成员，其他人"></a>拥有者，组成员，其他人</h1><p>在Linux的安全架构下，用户对文件的访问权限分为三个层次：拥有者（owner）、组成员（groups）、其他人（others）。一般来说，文件拥有者的访问权限最高，它不仅可以更改不同层次的用户对本文件的访问范围，也可以以更改文件所属组的形式授予新的用户以组成员访问权限。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ <span class="built_in">ls</span> -l ./foo.txt</span><br><span class="line">-rw-rw-r--. 1 meme meme 0 Jul 27 20:01 ./foo.txt</span><br></pre></td></tr></table></figure>

<p>对于上面的<code>foo.txt</code>文件，其拥有者和访问组依次为<code>meme</code>、<code>meme</code>。</p>
<blockquote>
<p>除了以组成员的形式赋予其他用户权限，文件拥有者还可以单独为某个用户赋予权限。</p>
</blockquote>
<h2 id="组"><a href="#组" class="headerlink" title="组"></a>组</h2><p>Linux用一串数字来标记不同的用户和组。使用<code>id</code>命令可以查看当前用户的用户标识和组标识：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ <span class="built_in">id</span></span><br><span class="line">uid=1001(meme) gid=1001(meme) <span class="built_in">groups</span>=1001(meme),10(wheel)</span><br></pre></td></tr></table></figure>

<p>其中，<code>uid</code>是当前用户的用户标识，<code>gid</code>是组标识，此处显示的<code>gid</code>是<strong>当前用户所在组</strong>（即当前用户创建文件时文件所属的组）的标识，最后的<code>groups</code>则是所有包含了当前用户的组及其标识。使用<code>groups</code>同样可以查询所有包含当前用户的组：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ <span class="built_in">groups</span></span><br><span class="line">meme wheel</span><br></pre></td></tr></table></figure>

<p>使用<code>newgrp [-] [group]</code>可以切换当前用户的工作组为指定组：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ newgrp wheel</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">id</span></span><br><span class="line">uid=1001(meme) gid=10(wheel) <span class="built_in">groups</span>=10(wheel),1001(meme) </span><br></pre></td></tr></table></figure>

<blockquote>
<p>为了方便权限分配，Linux会为每个用户创建一个独一无二的组作为默认工作组，如上面的<code>10001(meme)</code>。所有的用户信息被保持在了文件<code>/etc/passwd</code>中，组信息则被保持在了<code>/etc/group</code>中，这两个文件随着<code>/etc/shadow</code>的变动而修改，<code>/etc/shadow</code>包含了前面两个文件没有的用户信息，如用户密码的信息等。</p>
</blockquote>
<h2 id="常用组命令"><a href="#常用组命令" class="headerlink" title="常用组命令"></a>常用组命令</h2><p>只有<code>root</code>用户能够创建和管理组，因此对于组的管理都要在<code>root</code>用户下进行。</p>
<h3 id="groupadd：新建组"><a href="#groupadd：新建组" class="headerlink" title="groupadd：新建组"></a><code>groupadd</code>：新建组</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groupadd [options] GROUP</span><br></pre></td></tr></table></figure>

<p><code>groupadd</code>允许我们创建指定名称的组：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ sudo groupadd photo</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">cat</span> /etc/group</span><br><span class="line">root:x:0:</span><br><span class="line">...</span><br><span class="line">music:x:1002:meme,bob</span><br><span class="line">photo:x:1003:</span><br></pre></td></tr></table></figure>

<p>组一旦被创建，其信息就会被加入到<code>/etc/group</code>中。</p>
<h3 id="gpasswd：Group-Password，组管理"><a href="#gpasswd：Group-Password，组管理" class="headerlink" title="gpasswd：Group Password，组管理"></a><code>gpasswd</code>：Group Password，组管理</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpasswd [options] groupname</span><br></pre></td></tr></table></figure>
<p><code>gpasswd</code>命令是Linux下<code>/etc/group</code>和<code>/etc/shadow</code>的管理工具，实际上起着管理组的作用。其常用选项<code>-a</code>用于为指定组增加用户，<code>-d</code>用于为指定组删减用户：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ sudo gpasswd -a bob photo</span><br><span class="line">Adding user bob to group photo</span><br><span class="line">[meme@localhost Playground]$ sudo gpasswd -a meme photo</span><br><span class="line">Adding user meme to group photo</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">cat</span> /etc/group</span><br><span class="line">root:x:0:</span><br><span class="line">...</span><br><span class="line">photo:x:1003:bob,meme</span><br></pre></td></tr></table></figure>

<h1 id="权限"><a href="#权限" class="headerlink" title="权限"></a>权限</h1><p>Linux系统的文件通常有三种基本访问权限：读<code>r</code>、写<code>w</code>和执行<code>x</code>。</p>
<blockquote>
<p>对于普通文件，这些权限很清晰明了地定义了不同用户能对其进行的操作，但是对于目录文件，则有些许不同：</p>
<ul>
<li><code>r</code>表示可以用<code>ls</code>列出该目录下的文件，即可以读取目录列表；</li>
<li><code>w</code>表示可以在目录中增加或者删减文件；</li>
<li><code>x</code>表示允许用户在目录中查找，且可以以<code>cd</code>命令切换到该目录。</li>
</ul>
<p>说白了，<code>rwx</code>都表示的是对文件内容的使用权力。</p>
</blockquote>
<p>当我们用<code>ls -l</code>列出文件的详细元数据时，前面的<strong>10</strong>个字符是文件的属性，后面的2个字符串分别是文件的拥有者和访问组，然后是文件的大小、文件的修改时间以及文件名称。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ <span class="built_in">ls</span> -l foo.txt</span><br><span class="line">-rw-rw-r--. 1 meme meme 6 Jul 27 22:22 foo.txt</span><br></pre></td></tr></table></figure>

<ul>
<li>第1个字符表文件的<strong>类型</strong>，<code>-</code>表普通文件，<code>d</code>表目录文件；</li>
<li>第2~10个字符的每三个字符依次表明文件拥有组、访问组和其他用户对该文件的访问权限，顺序为<code>rwx</code>。</li>
</ul>
<h2 id="chmod：Change-Mode，更改文件权限"><a href="#chmod：Change-Mode，更改文件权限" class="headerlink" title="chmod：Change Mode，更改文件权限"></a><code>chmod</code>：Change Mode，更改文件权限</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> [OPTION]... MODE[,MODE]... FILE...</span><br></pre></td></tr></table></figure>

<p><code>chmod</code>以3个八进制数字来分别代表文件拥有者、访问组和其他用户的目标访问权限，如<code>6</code>表示<code>110</code>，权限为<code>rw-</code>；<code>4</code>表示<code>100</code>，权限为<code>r--</code>；<code>0</code>表示<code>000</code>，权限为<code>---</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ <span class="built_in">chmod</span> 600 foo.txt</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">ls</span> -l foo.txt</span><br><span class="line">-rw-------. 1 meme meme 6 Jul 27 22:22 foo.txt</span><br></pre></td></tr></table></figure>

<p>除了以数字来直接代表目标权限，<code>chmod</code>也支持符号形式的表示：</p>
<ul>
<li><code>u</code>、<code>g</code>、<code>o</code>分别表示文件拥有者、访问组和其他用户；</li>
<li><code>+</code>，<code>-</code>，<code>=</code>分别表示添加、减少和指定权限；</li>
<li><code>r</code>、<code>w</code>、<code>x</code>分别表示3种权限。</li>
<li>如：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ <span class="built_in">chmod</span> u-r,go=rw foo.txt</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">ls</span> -l foo.txt</span><br><span class="line">--w-rw-rw-. 1 meme meme 6 Jul 27 22:22 foo.txt</span><br></pre></td></tr></table></figure>

<h2 id="umask：User-File-Creation-Mode-Mask，设置默认权限"><a href="#umask：User-File-Creation-Mode-Mask，设置默认权限" class="headerlink" title="umask：User File-Creation Mode Mask，设置默认权限"></a><code>umask</code>：User File-Creation Mode Mask，设置默认权限</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">umask</span> [-p] [-S] [mode]</span><br></pre></td></tr></table></figure>

<p><code>umask</code>让我们能够设置在当前用户下创建文件时，各用户的初始权限：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ <span class="built_in">umask</span> 002</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">touch</span> f.txt</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">ls</span> -l f.txt</span><br><span class="line">-rw-rw-r--. 1 meme meme 0 Jul 27 22:50 f.txt</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">umask</span> 022</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">touch</span> d.txt</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">ls</span> -l d.txt</span><br><span class="line">-rw-r--r--. 1 meme meme 0 Jul 27 22:51 d.txt</span><br></pre></td></tr></table></figure>

<p>其中每位数字（依次代表文件拥有者、访问组和其他用户）都代表一个二进制形式的<strong>掩码</strong>，即<code>2</code>等价于<code>010</code>，表示遮盖<code>rwx</code>中的第二位<code>w</code>。</p>
<blockquote>
<p>此处<code>x</code>也被遮盖的原因是<code>.txt</code>文件无法被执行，也就是说它没有<code>x</code>操作。<br><code>umask</code>设置的掩码不是永久的，它只在当前的shell上生效。</p>
</blockquote>
<h2 id="chown：Change-Owner，更改文件所有者和访问组"><a href="#chown：Change-Owner，更改文件所有者和访问组" class="headerlink" title="chown：Change Owner，更改文件所有者和访问组"></a><code>chown</code>：Change Owner，更改文件所有者和访问组</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chown</span> [options] owner[:group] file...</span><br></pre></td></tr></table></figure>

<p>如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ sudo <span class="built_in">chown</span> bob:photo foo.txt</span><br><span class="line">[sudo] password <span class="keyword">for</span> meme: </span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">ls</span> -l foo.txt</span><br><span class="line">--w-rw-rw-. 1 bob photo 6 Jul 27 22:22 foo.txt</span><br><span class="line">[meme@localhost Playground]$ sudo <span class="built_in">chown</span> meme:photo foo.txt</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">ls</span> -l foo.txt</span><br><span class="line">--w-rw-rw-. 1 meme photo 6 Jul 27 22:22 foo.txt</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">chown</span> :meme foo.txt</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">ls</span> -l foo.txt</span><br><span class="line">--w-rw-rw-. 1 meme meme 6 Jul 27 22:22 foo.txt</span><br></pre></td></tr></table></figure>

<p>其中，若文件的所有者是自己且要将该文件的访问组改回自己，则无需<code>root</code>权限，如最后一个命令所示。</p>
<h2 id="特殊权限"><a href="#特殊权限" class="headerlink" title="特殊权限"></a>特殊权限</h2><p>除了上面的3种权限<code>rwx</code>，Linux还提供另外3种特殊权限<code>setuid</code>、<code>setgid</code>和<code>sticky</code>。</p>
<h3 id="setuid-amp-setgid"><a href="#setuid-amp-setgid" class="headerlink" title="setuid &amp; setgid"></a><code>setuid</code> &amp; <code>setgid</code></h3><p><code>setuid</code>和<code>setgid</code>的符号均为<code>s</code>，只不过前者只存在于文件拥有者，而后者只存在于文件的访问组。它们的作用相似：当拥有<code>s</code>权限的<strong>可执行文件</strong>被运行时，该可执行文件会以拥有<code>s</code>权限的文件拥有者或者拥有<code>s</code>权限的访问组的身份运行，即，若文件夹<code>dir</code>（文件夹是一种特殊的可执行文件）的访问组<code>photo</code>没有<code>s</code>权限，<code>meme</code>用户在<code>dir</code>下创建文件的访问组仍然是<code>meme</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost <span class="built_in">dir</span>]$ <span class="built_in">touch</span> foo.txt</span><br><span class="line">[meme@localhost <span class="built_in">dir</span>]$ <span class="built_in">ls</span> -al</span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x. 2 meme photo  21 Jul 27 23:12 .</span><br><span class="line">...</span><br><span class="line">-rw-r--r--. 1 meme meme  0 Jul 27 23:12 foo.txt</span><br></pre></td></tr></table></figure>

<p>反之，若赋予<code>dir</code>的访问组以<code>s</code>权限（要在<code>root</code>下才能赋予成功），则<code>meme</code>用户在<code>dir</code>下创建的文件的访问组仍然是<code>photo</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost <span class="built_in">dir</span>]$ sudo <span class="built_in">chmod</span> g+s .</span><br><span class="line">[meme@localhost <span class="built_in">dir</span>]$ <span class="built_in">ls</span> -al</span><br><span class="line">total 0</span><br><span class="line">drwxr-sr-x. 2 meme photo  21 Jul 27 23:17 .</span><br><span class="line">...</span><br><span class="line">-rw-r--r--. 1 meme meme  0 Jul 27 23:12 foo.txt</span><br><span class="line">[meme@localhost <span class="built_in">dir</span>]$ <span class="built_in">touch</span> ff.txt</span><br><span class="line">[meme@localhost <span class="built_in">dir</span>]$ <span class="built_in">ls</span> -al</span><br><span class="line">total 0</span><br><span class="line">drwxr-sr-x. 2 meme photo  35 Jul 27 23:22 .</span><br><span class="line">...</span><br><span class="line">-rw-r--r--. 1 meme photo   0 Jul 27 23:22 ff.txt</span><br><span class="line">-rw-r--r--. 1 meme meme  0 Jul 27 23:12 foo.txt</span><br></pre></td></tr></table></figure>

<p>在上面的代码框中，当前文件夹<code>dir</code>的访问组权限由<code>r-x</code>变为了<code>r-s</code>。之后新创建的<code>ff.txt</code>的访问组也相应地变成了<code>dir</code>的访问组。</p>
<h3 id="sticky"><a href="#sticky" class="headerlink" title="sticky"></a><code>sticky</code></h3><p>为文件附加<code>sticky</code>（标识<code>t</code>）位的操作为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +t FILE</span><br></pre></td></tr></table></figure>

<p>这个权限用处不大，一般只用于目录文件，它能阻止用户删除或重命名该目录下的文件，除非用户是这个目录的所有者，或者是文件所有者，或是是超级用户<code>root</code>。</p>
<h2 id="passwd：修改用户密码"><a href="#passwd：修改用户密码" class="headerlink" title="passwd：修改用户密码"></a><code>passwd</code>：修改用户密码</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passwd [user]</span><br></pre></td></tr></table></figure>

<p>我们可以使用该命令修改指定用户的登陆密码</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul>
<li><a target="_blank" rel="noopener" href="https://www.kancloud.cn/thinkphp/linux-command-line/39440">The Linux Command Line 中文版 第十章：权限</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://zclzcl0223.github.io/2023/07/25/SystemSecurityPermission/" data-id="clzik0lcz008vv47kacgn3h67" data-title="System Security and Permissions" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Tool/" rel="tag">Tool</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-ProcessManagement" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/25/ProcessManagement/" class="article-date">
  <time class="dt-published" datetime="2023-07-25T10:22:44.000Z" itemprop="datePublished">2023-07-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Tool/">Tool</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/25/ProcessManagement/">Process Management</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <span id="more"></span>

<ul>
<li><a target="_blank" rel="noopener" href="https://www.kancloud.cn/thinkphp/linux-command-line/39441">The Linux Command Line 中文版 第十一章：进程</a></li>
</ul>
<p><img src="/1.png" alt="1"></p>
<center style="font-size:12px; font-weight:bold">Fig. 1. </center><br>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://zclzcl0223.github.io/2023/07/25/ProcessManagement/" data-id="clzik0lcs006xv47k6qn865p1" data-title="Process Management" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Tool/" rel="tag">Tool</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-NetworkRemoteInteraction" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/25/NetworkRemoteInteraction/" class="article-date">
  <time class="dt-published" datetime="2023-07-25T10:21:40.000Z" itemprop="datePublished">2023-07-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Tool/">Tool</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/25/NetworkRemoteInteraction/">Network and Remote Interaction</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <span id="more"></span>

<h1 id="netstat：Network-Statistics，查看本机网络信息"><a href="#netstat：Network-Statistics，查看本机网络信息" class="headerlink" title="netstat：Network Statistics，查看本机网络信息"></a><code>netstat</code>：Network Statistics，查看本机网络信息</h1><p><code>netstat</code>程序被用来检测各种各样的本机网络设置。通过选用不同的选项，我们可以查看有关本机的不同网络信息。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat [OPTION]</span><br></pre></td></tr></table></figure>

<p>如，<code>-ie</code>选项使得我们可以查看本系统的所有网络接口：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost ~]$ netstat -ie</span><br><span class="line">Kernel Interface table</span><br><span class="line">ens33: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.115.128  netmask 255.255.255.0  broadcast 192.168.115.255</span><br><span class="line">        inet6 fe80::9b04:dd5e:b9d5:202f  prefixlen 64  scopeid 0x20&lt;<span class="built_in">link</span>&gt;</span><br><span class="line">        ether 00:0c:29:0a:87:bc  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 3440  bytes 258371 (252.3 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 654  bytes 80314 (78.4 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen 1  (Local Loopback)</span><br><span class="line">        RX packets 456  bytes 95634 (93.3 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 456  bytes 95634 (93.3 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>上述两个网络接口中，第一个<code>ens33</code>是因特网接口，主要信息有IPv4地址、掩码以及IPv6地址等；第二个接口<code>lo</code>就是我们常说的内部回环网络接口，其IPv4地址以<code>127</code>开头。</p>
<blockquote>
<p>除<code>-ie</code>外还有许多选项，如<code>-r</code>选项可以查看本机的路由表等。</p>
</blockquote>
<h1 id="wget：World-Wide-Web-Get，从网页中下载文件"><a href="#wget：World-Wide-Web-Get，从网页中下载文件" class="headerlink" title="wget：World Wide Web Get，从网页中下载文件"></a><code>wget</code>：World Wide Web Get，从网页中下载文件</h1><p><code>wget</code>程序将互联网上的文件下载到当前目录，它的使用很简单，一般为<code>wget</code>+目标文件的域名（URL）。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget [OPTION]... [URL]...</span><br></pre></td></tr></table></figure>

<h1 id="ssh：Secure-Shell，安全的远程登陆"><a href="#ssh：Secure-Shell，安全的远程登陆" class="headerlink" title="ssh：Secure Shell，安全的远程登陆"></a><code>ssh</code>：Secure Shell，安全的远程登陆</h1><p><code>ssh</code>既是一个互联网协议，又是Linux命令行中的一个程序。在SSH之前，常用的远程登录协议有Rlogin和Telnet，这两个协议的重大缺陷是所有的通讯信息均以<strong>明文</strong>的方式传播，因而十分地不安全。SSH从两个方面解决了这个问题：</p>
<ol>
<li>SSH客户端所连接的远程主机必须为客户端所知，由此阻止了中间人攻击；</li>
<li>SSH对本地客户端主机和远程主机之间的通信进行了加密。</li>
</ol>
<p>SSH由两部分组成，运行在本地的SSH客户端和运行在远端主机的SSH服务器。一般来说，Linux发行版会自带一个提供SSH功能的软件包OpenSSH，它包括OpenSSH-client和OpenSSH-server两个分别提供客户端和服务器服务的程序，但是有些发行版（如Ubuntu）的OpenSSH只包含了OpenSSH-client。要想让系统能够接受远程客户端的连接，则必须手动安装OpenSSH-server。</p>
<h2 id="SSH配置"><a href="#SSH配置" class="headerlink" title="SSH配置"></a>SSH配置</h2><p>无论是想让系统充当远程的服务器还是想让系统能够作为客户端连接远程主机，都必须要正确地配置相关的SSH文件。对于Linux系统，SSH服务器的配置文件通常是<code>/etc/ssh/sshd_config</code>，SSH客户端的配置文件通常是<code>~/.ssh/config</code>，以上两个文件若没有则需要自己创建。</p>
<h3 id="SSH客户端配置与连接"><a href="#SSH客户端配置与连接" class="headerlink" title="SSH客户端配置与连接"></a>SSH客户端配置与连接</h3><p>对于一般用户来说，SSH客户端是更常用的一方，因此只介绍SSH客户端的配置。通常，有4个主要配置项：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">Host</span> [<span class="string">HOST</span> <span class="string">NAME</span>]</span><br><span class="line">    <span class="string">HostName</span> [<span class="string">HOST</span> <span class="string">IP</span>]</span><br><span class="line">    <span class="string">User</span> [<span class="string">USER</span> <span class="string">NAME</span>]</span><br><span class="line">    <span class="string">Port</span> [<span class="string">PORT</span>]</span><br></pre></td></tr></table></figure>
<p>其中，<code>Host</code>是用户为该远程主机指定的标识符，可任意；<code>HostName</code>是该远程主机的公网IP地址；<code>User</code>则是用户登录远程主机时的默认身份，该身份必须是远程主机上有且允许远程登录的用户；<code>Port</code>是要连接的SSH服务器监听的端口，要与远程主机SSH服务器配置文件中的端口匹配。配置完成后，我们便可用命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh [HOST NAME] 或</span><br><span class="line">ssh [HOST IP]</span><br></pre></td></tr></table></figure>

<p>连接远程主机。当然，我们也可以以远程主机允许的其他用户身份登录：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh [OTHER USER NAME]@[HOST NAME]</span><br></pre></td></tr></table></figure>

<p>一般来说，我们登录远程主机的验证方式默认为输入登录用户的密码，当然也可以在配置文件中增加<code>IdentityFile</code>选项使得我们能以私钥文件的形式实现免密登录。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost ~]$ ssh remote-sys</span><br><span class="line">The authenticity of host <span class="string">&#x27;remote-sys (xxx.xxx.xxx.xxx)&#x27;</span> can<span class="string">&#x27;t be</span></span><br><span class="line"><span class="string">established.</span></span><br><span class="line"><span class="string">ECDSA key fingerprint is xxxxxxxxxxxxxxxxxxx.</span></span><br><span class="line"><span class="string">ECDSA key fingerprint is xxxxxxxxxxxxxxxxxxx.</span></span><br><span class="line"><span class="string">Are you sure you want to continue connecting (yes/no)?yes</span></span><br><span class="line"><span class="string">Warning: Permanently added &#x27;</span>remote-sys,xxx.xxx.xxx.xxx<span class="string">&#x27; (RSA) to the list</span></span><br><span class="line"><span class="string">of known hosts.</span></span><br><span class="line"><span class="string">Bob@xxx.xxx.xxx.xxx&#x27;</span>s password: </span><br></pre></td></tr></table></figure>

<blockquote>
<p>第一次登录未曾登录过的远程主机时，客户端会启动保护机制，如上面的<code>Are you sure...</code>。成功输入密码后，我们便进入了远端的shell会话，直到我们输入<code>exit</code>，该会话都会一直存在。</p>
<p>需要注意的是，有时远程登录会报错<code>Bad owner or permissions on ~/.ssh/config</code>，这是因为有其他的用户拥有了对<code>~/.ssh/config</code>的使用权限，我们只要用<code>chmod 600 ~/.ssh/config</code>使得该文件只能由文件拥有者操作即可。</p>
</blockquote>
<p>若没有可用的远程主机，则可以用<code>localhost</code>作为远端主机名，此时计算机会和自己建立“远程连接”且无需输入密码。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost ~]$ ssh localhost</span><br><span class="line">Last login: Tue Aug  1 03:58:03 2023 from localhost</span><br><span class="line">[meme@localhost ~]$ <span class="built_in">date</span></span><br><span class="line">Tue Aug  1 04:00:53 PDT 2023</span><br><span class="line">[meme@localhost ~]$ <span class="built_in">exit</span></span><br><span class="line"><span class="built_in">logout</span></span><br><span class="line">Connection to localhost closed.</span><br><span class="line">[meme@localhost ~]$ <span class="built_in">date</span></span><br><span class="line">Tue Aug  1 04:01:04 PDT 2023</span><br></pre></td></tr></table></figure>

<p>有时，我们只想用远程主机执行个位数的命令，那么我们就没有必要登录又退出远程主机，而是可以直接在连接过程中就发送我们想要执行的命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost ~]$ ssh remote-sys <span class="string">&#x27;ls ..&#x27;</span></span><br><span class="line">Bob@xxx.xxx.xxx.xxx<span class="string">&#x27;s password: </span></span><br><span class="line"><span class="string">dev</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="string">var</span></span><br><span class="line"><span class="string">Killed by signal 1.</span></span><br><span class="line"><span class="string">[meme@localhost ~]$ </span></span><br></pre></td></tr></table></figure>

<p>上面的<code>ls ..</code>让远程主机执行<code>ls</code>命令列出默认登录目录的父目录的内容，然后就退出登录。特别需要注意的是，引号表示该命令由远程主机执行，因此下面两个命令得到的是完全不同的结果：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost ~]$ ssh remote-sys <span class="string">&#x27;ls ..&#x27;</span> &gt; dirlist.txt</span><br><span class="line">[meme@localhost ~]$ ssh remote-sys <span class="string">&#x27;ls .. &gt; dirlist.txt&#x27;</span></span><br></pre></td></tr></table></figure>

<p>其中，第一个命令是让远程主机列出父目录的内容并将结果重定向至本地的<code>dirlist.txt</code>文件；而第二个命令则是让远程主机列出父目录的内容并将结果重定向至<strong>远程主机</strong>的<code>dirlist.txt</code>文件。</p>
<h2 id="scp：Secure-Copy，安全的远程复制"><a href="#scp：Secure-Copy，安全的远程复制" class="headerlink" title="scp：Secure Copy，安全的远程复制"></a><code>scp</code>：Secure Copy，安全的远程复制</h2><p><code>scp</code>是OpenSSH的内置程序，它基于SSH实现安全的远程复制：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp [[USER@]HOST:]FILE</span><br></pre></td></tr></table></figure>

<p>它的用法很简单，<code>scp</code>+SSH远程服务器+目标文件。程序运行的结果是远程的目标文件被复制到本地目录。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost ~]$ scp remote-sys:document.txt</span><br></pre></td></tr></table></figure>

<h2 id="sftp：Secure-FTP，安全的FTP"><a href="#sftp：Secure-FTP，安全的FTP" class="headerlink" title="sftp：Secure FTP，安全的FTP"></a><code>sftp</code>：Secure FTP，安全的FTP</h2><p><code>sftp</code>是用SSH强化了安全性的FTP协议，它也是OpenSSH的内置程序，同样也是基于SSH实现的。其用法与常规的<code>ftp</code>命令完全一样，只不过远程的SSH服务器充当了FTP服务器：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost ~]$ sftp remote-sys</span><br><span class="line">Connecting to remote-sys...</span><br><span class="line">me@remote-sys<span class="string">&#x27;s password:</span></span><br><span class="line"><span class="string">sftp&gt; ls</span></span><br><span class="line"><span class="string">ubuntu-8.04-desktop-i386.iso</span></span><br><span class="line"><span class="string">sftp&gt; lcd Desktop</span></span><br><span class="line"><span class="string">sftp&gt; get ubuntu-8.04-desktop-i386.iso</span></span><br><span class="line"><span class="string">Fetching /home/me/ubuntu-8.04-desktop-i386.iso to ubuntu-8.04-</span></span><br><span class="line"><span class="string">desktop-i386.iso</span></span><br><span class="line"><span class="string">/home/me/ubuntu-8.04-desktop-i386.iso 100% 699MB 7.4MB/s 01:35</span></span><br><span class="line"><span class="string">sftp&gt; bye</span></span><br></pre></td></tr></table></figure>

<p>输入密码后，我们将登录远程的shell。<code>lcd</code>指令即“Local Change Directory”，是指切换本地主机，即客户端主机的目录，而<code>cd</code>才是切换远程服务器的目录。<code>get</code>使得远程的文件被传输到本地主机的<code>Desktop</code>目录下。输入<code>bye</code>或<code>exit</code>或<code>quit</code>我们将退出远程服务器。</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul>
<li><a target="_blank" rel="noopener" href="https://www.kancloud.cn/thinkphp/linux-command-line/39448">The Linux Command Line 中文版 第十七章：网络系统</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://zclzcl0223.github.io/2023/07/25/NetworkRemoteInteraction/" data-id="clzik0lco005yv47kco11crvc" data-title="Network and Remote Interaction" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Tool/" rel="tag">Tool</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-PackageProcessing" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/25/PackageProcessing/" class="article-date">
  <time class="dt-published" datetime="2023-07-25T10:20:25.000Z" itemprop="datePublished">2023-07-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Tool/">Tool</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/25/PackageProcessing/">Package Management and Processing</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <span id="more"></span>

<h1 id="Linux的软件包管理系统"><a href="#Linux的软件包管理系统" class="headerlink" title="Linux的软件包管理系统"></a>Linux的软件包管理系统</h1><p>Linux发行版本质量最重要的决定因素是软件包管理系统和其支持社区的持久性。其中，软件包管理系统即Linux的打包系统，它负责从其支持的社区，即资源库（类似于手机上的软件商店）中搜索用户想要的软件包，并替用户完成从软件包到软件的安装。软件包管理系统通常由两种工具类型组成：</p>
<ul>
<li>安装和删除软件包文件的<strong>底层工具</strong>；</li>
<li>在资源库中完成元数据、软件包搜索和依赖解析（软件很少是独立运行的，其运行过程中需要用到的其他软件就是它的依赖程序，某一软件包安装的同时也要确保依赖程序也被正确安装）的<strong>上层工具</strong>，其作用类似于Python的<code>pip</code>和<code>conda</code>。</li>
</ul>
<p>不同的Linux发行版本使用的软件包管理系统不尽相同，但是主流的基本都属于Debian的<code>.deb</code>或Red Hat的<code>.rpm</code>阵营：</p>
<style> table th {
    width: 10px;
}
</style>

<table>
<thead>
<tr>
<th align="center">包管理系统</th>
<th align="center">底层工具</th>
<th align="center">上层工具</th>
<th align="center">发行版本</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Debian Style(.deb)</td>
<td align="center">dpkg</td>
<td align="center">apt, apt-get, apt-cache, aptitude</td>
<td align="center">Ubuntu, Debian, Xandros, Linspire</td>
</tr>
<tr>
<td align="center">Red Hat Style (.rpm)</td>
<td align="center">rpm</td>
<td align="center">yum</td>
<td align="center">CentOS, Fedora, Red Hat Enterprise Linux, OpenSUSE, Mandriva, PCLinuxOS</td>
</tr>
</tbody></table>
<h2 id="Debian-Style"><a href="#Debian-Style" class="headerlink" title="Debian Style"></a>Debian Style</h2><p>当前的主流Linux发行版本，如Ubuntu、Debian，使用的都是Debian Style的包管理系统。相比于Red Hat Style的包管理系统，Debian Style的上层工具要更加多样，但也相应更加复杂。<code>apt-get</code>和<code>apt-cache</code>是最早的支持Debian包管理系统的上层工具；<code>apt</code>包含了<code>apt-get</code>和<code>apt-cache</code>中最常用命令选项的集合，但是<code>apt</code>本身要更加简洁；<code>aptitude</code>功能更加全面，且在搜索上的表现优于<code>apt</code>。一些常用的指令有：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查找资源库软件包</span></span><br><span class="line">apt-cache search [search_string] 或 apt search [search_string]</span><br><span class="line"><span class="comment"># 从资源库中安装一个软件包 </span></span><br><span class="line">apt-get install [package_name] 或 apt install [package_name] </span><br><span class="line"><span class="comment"># 卸载软件</span></span><br><span class="line">apt-get remove [package_name] 或 apt remove [package_name]</span><br><span class="line"><span class="comment"># 自动删除不需要的包</span></span><br><span class="line">apt-get autoremove 或 apt autoremove</span><br><span class="line"><span class="comment"># 经过资源库升级所有可升级的软件包</span></span><br><span class="line">apt-get upgrade 或 apt upgrade</span><br><span class="line"><span class="comment"># 在升级软件包的时候自动处理依赖关系</span></span><br><span class="line">apt-get dist-upgrade 或 apt full-upgrade</span><br><span class="line"><span class="comment"># 显示所安装软件包的说明信息</span></span><br><span class="line">apt-cache show [package_name] 或 apt show [package_name]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>事实上，在<strong>查找</strong><code>search</code>、<strong>安装</strong><code>install</code>和<strong>更新</strong><code>upgrade</code>软件包时，上层工具都会去搜索软件包列表，软件包列表里包含了各类软件包的信息。但是，软件包列表会随时间变化，如添加新的包、删除旧的包等都会导致列表发生变化，而上层工具搜索的往往是软件包列表的<strong>缓存</strong>，因此，在进行前面的3项操作前，应先用<code>apt-get update</code>或<code>apt update</code>刷新软件包列表缓存。</p>
<p><code>search</code>所用到的<code>[search_string]</code>可以是软件包的名字，也可以是软件包的说明信息。</p>
<p><code>aptitude</code>的指令名字与使用方式和其他3个基本一致。</p>
</blockquote>
<p>通常，以指令调用上层工具后，上层工具会自动调用下层工具帮助我们完成后续的安装任务，不过有时我们可能会直接得到软件包<code>.deb</code>文件，这时我们就可以直接使用底层工具来处理它们：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过软件包安装软件</span></span><br><span class="line">dpkg --install [package_file]</span><br><span class="line"><span class="comment"># 通过软件包升级软件</span></span><br><span class="line">dpkg --install [package_file]</span><br><span class="line"><span class="comment"># 列出所有安装的软件包</span></span><br><span class="line">dpkg --list</span><br><span class="line"><span class="comment"># 确定是否安装了某个软件</span></span><br><span class="line">dpkg --status [package_name]</span><br><span class="line"><span class="comment"># 查找安装了指定文件的软件包</span></span><br><span class="line">dpkg --search file_name</span><br></pre></td></tr></table></figure>

<blockquote>
<p>需要注意的是，直接通过软件包安装文件时，底层工具不会帮助我们完成依赖解析，因此若其发现缺少了某个依赖程序，它会直接报错并退出。一旦发生这种情况，我们就需要手动地安装依赖程序。</p>
<p><code>apt</code>的全称是Advanced Packaging Tool，而<code>dpkg</code>的全称是Debian Packager。</p>
</blockquote>
<h2 id="Red-Hat-Style"><a href="#Red-Hat-Style" class="headerlink" title="Red Hat Style"></a>Red Hat Style</h2><p>Red Hat Style的上层工具只有<code>yum</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查找资源库软件包</span></span><br><span class="line">yum search [search_string]</span><br><span class="line"><span class="comment"># 从资源库中安装一个软件包 </span></span><br><span class="line">yum install [package_name]</span><br><span class="line"><span class="comment"># 卸载软件</span></span><br><span class="line">yum erase [package_name]</span><br><span class="line"><span class="comment"># 经过资源库升级所有可升级的软件包</span></span><br><span class="line">yum update</span><br><span class="line"><span class="comment"># 显示所安装软件包的说明信息</span></span><br><span class="line">yum info show [package_name]</span><br></pre></td></tr></table></figure>

<p>同样地，Red Hat Style也支持用底层工具直接安装<code>.rpm</code>文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过软件包安装软件</span></span><br><span class="line">rpm -i [package_file]</span><br><span class="line"><span class="comment"># 通过软件包升级软件</span></span><br><span class="line">rpm -U [package_file]</span><br><span class="line"><span class="comment"># 列出所有安装的软件包</span></span><br><span class="line">rpm -qa</span><br><span class="line"><span class="comment"># 确定是否安装了某个软件</span></span><br><span class="line">rpm -q [package_name]</span><br><span class="line"><span class="comment"># 查找安装了指定文件的软件包</span></span><br><span class="line">rpm -qf file_name</span><br></pre></td></tr></table></figure>

<blockquote>
<p>使用<code>rpm</code>直接安装软件包同样需要我们自己处理依赖程序。</p>
<p><code>yum</code>的全称是Yellow dog Updater, Modified，<code>rpm</code>的全称是Red Hat Package Manager。</p>
</blockquote>
<h1 id="压缩，归档，备份"><a href="#压缩，归档，备份" class="headerlink" title="压缩，归档，备份"></a>压缩，归档，备份</h1><p>压缩包、文件包是另外两种常见的“包文件”。不像软件包是用于装载某个可执行程序的，它们是用于更好地存储、管理、归档和备份文件以保护重要数据的。</p>
<h2 id="压缩文件"><a href="#压缩文件" class="headerlink" title="压缩文件"></a>压缩文件</h2><p>压缩（Zip、Compress），顾名思义就是通过压缩算法，使得计算机能以尽可能小的空间来存储未压缩文件。压缩算法分两大类：</p>
<ul>
<li><strong>无损压缩</strong>：无损压缩保留了原文件的所有数据。当还原一个被压缩文件时，还原文件将与原文件一模一样；</li>
<li><strong>有损压缩</strong>：有损压缩允许压缩操作时删除一些数据，使得文件得到更大的压缩率。当一个有损压缩文件被还原时，它与原文件将存在差异。有损压缩一般用于少量的损失不影响原文件效果的文件，如图片、视频等。JPEG和MP3就是常见的有损压缩文件。</li>
</ul>
<h3 id="gzip：强大的无损压缩程序"><a href="#gzip：强大的无损压缩程序" class="headerlink" title="gzip：强大的无损压缩程序"></a><code>gzip</code>：强大的无损压缩程序</h3><p><code>gzip</code>，全称GNUzip，是GNU计划实现的一款Linux系统常用的无损压缩程序。<code>gunzip</code>则是其对应的解压程序。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gzip [OPTION]... [FILE]...</span><br><span class="line">gunzip [OPTION]... [FILE]...</span><br></pre></td></tr></table></figure>

<p><code>gzip</code>在执行压缩操作时，原文件会被压缩文件<code>[FILE].gz</code>替代；解压时，<code>[FILE].gz</code>又会被还原为原文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ <span class="built_in">ls</span> -l /etc | <span class="built_in">cat</span> &gt; foo.txt</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">ls</span> -l foo.*</span><br><span class="line">--w-rw-rw-. 1 meme meme 16387 Jul 31 00:45 foo.txt</span><br><span class="line">[meme@localhost Playground]$ sudo gzip foo.txt</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">ls</span> -l foo.*</span><br><span class="line">--w-rw-rw-. 1 meme meme 3219 Jul 31 00:45 foo.txt.gz</span><br><span class="line">[meme@localhost Playground]$ sudo gunzip foo.txt.gz</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">ls</span> -l foo.*</span><br><span class="line">--w-rw-rw-. 1 meme meme 16387 Jul 31 00:45 foo.txt</span><br></pre></td></tr></table></figure>

<p>不难看出，压缩后的<code>[FILE].gz</code>文件大小约为原文件的1&#x2F;5。解压后的文件与原文件一模一样，包括权限、修改时间等。<code>gzip</code>和<code>gunzip</code>的<code>[OPTION]</code>选项有很多，常用的有：</p>
<ul>
<li><code>-c</code>：把程序输出写入到标准输出，并且保留原始文件。用在<code>gzip</code>上会使得此次<code>gzip</code>操作将压缩后的文件内容（一堆乱码）直接输出在标准输出上，而原文件不发生变化：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ <span class="built_in">ls</span></span><br><span class="line"><span class="built_in">dir</span>  foo.txt</span><br><span class="line">[meme@localhost Playground]$ sudo gzip -c foo.txt</span><br><span class="line">�f�d</span><br><span class="line">...</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">ls</span></span><br><span class="line"><span class="built_in">dir</span>  foo.txt</span><br></pre></td></tr></table></figure>
用在<code>gunzip</code>上会使得<code>gunzip</code>直接输出解压后文件的内容，而并不解压文件：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ sudo gzip foo.txt</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">ls</span></span><br><span class="line"><span class="built_in">dir</span>  foo.txt.gz</span><br><span class="line">[meme@localhost Playground]$ sudo gunzip -c foo.txt.gz</span><br><span class="line">total 1424</span><br><span class="line">...</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">ls</span></span><br><span class="line"><span class="built_in">dir</span>  foo.txt.gz</span><br></pre></td></tr></table></figure>
<code>zcat</code>（zip &amp; cat）命令相当于使用了<code>-c</code>的<code>gunzip</code>。</li>
<li><code>-d</code>：意为decompress，只用于<code>gzip</code>，带<code>-d</code>选项的<code>gzip</code>作用相当于<code>gunzip</code>。</li>
<li><code>-f</code>：意为force，指强制压缩原文件，即便原始文件已经被压缩。</li>
<li><code>-r</code>：意为recursive，若命令行中有一个或多个参数为目录，则递归地压缩目录中文件。</li>
</ul>
<h3 id="bzip2：慢但更彻底的gzip"><a href="#bzip2：慢但更彻底的gzip" class="headerlink" title="bzip2：慢但更彻底的gzip"></a><code>bzip2</code>：慢但更彻底的<code>gzip</code></h3><p><code>bzip2</code>与<code>gzip</code>相似，但是使用了不同的压缩算法，使得<code>bzip2</code>可以做到更高的压缩级别，但速度就稍微慢了一点。除了<code>bzip2</code>的压缩文件名字后缀为<code>.bz2</code>，<code>bzip2</code>与<code>gzip</code>的功能几乎一模一样，包括压缩文件替代原文件、除<code>-r</code>以外的选项以及<code>bunzip2</code>和<code>bzcat</code>完成解压缩。</p>
<h2 id="归档文件"><a href="#归档文件" class="headerlink" title="归档文件"></a>归档文件</h2><p>相比于压缩文件包，我们更常见的是普通的文件包，即归档文件包，Windows上的<code>.zip</code>文件包就是一种常见的归档文件包。所谓归档（Archive），即把一群文件捆绑成一个大的文件的过程。归档通常只是将目标文件群集中地放在一个归档文件包中，但有些归档程序，如<code>zip</code>，还包含着压缩的功能。</p>
<h3 id="tar：经典Linux归档工具"><a href="#tar：经典Linux归档工具" class="headerlink" title="tar：经典Linux归档工具"></a><code>tar</code>：经典Linux归档工具</h3><p><code>tar</code>，全称Tape Archive，是Linux系统中最常用的归档工具。一个<code>tar</code>包可以由一组独立的文件、一个或者多个目录或前两者的混合体组成。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar MODE[OPTION...] [PATH]...</span><br></pre></td></tr></table></figure>

<p>上边的<code>MODE</code>指<code>tar</code>的不同操作模式，常用的有：</p>
<ul>
<li><code>c</code>：为文件、目录、目录列表创建归档文件；</li>
<li><code>x</code>：抽取归档文件；</li>
<li><code>r</code>：追加具体的路径到归档文件末尾；</li>
<li><code>t</code>：列出归档文件的内容。</li>
</ul>
<p>而常用的<code>[OPTION]</code>有：</p>
<ul>
<li><code>-f</code>：意为file，指定归档文件包的名字；</li>
<li><code>-v</code>：意为verbose，显示命令的整个执行过程；</li>
<li><code>-z</code>：意为gzip，对归档文件包使用<code>gzip</code>压缩；</li>
<li><code>-j</code>：意为bip2，对归档文件包使用<code>bzip2</code>压缩。</li>
</ul>
<blockquote>
<p>一般来说，模式只能选择一个，而选项可以选择多个。确定了模式后，选项可以直接跟在模式后面，而无需用空格或<code>-</code>分割。</p>
<p> <code>tar</code>包的后缀名为<code>.tar</code>，经过<code>gzip</code>压缩的<code>tar</code>包后缀名为<code>.tgz</code>，经过<code>bzip2</code>压缩的<code>tar</code>包后缀名为<code>.tbz</code>。</p>
</blockquote>
<p>在进一步了解<code>tar</code>之前，我们先在当前目录下创建<code>playground</code>目录，并在其下创建100个子目录，在每个子目录下创建24个普通文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ <span class="built_in">mkdir</span> -p ./playground/dir-&#123;00&#123;1..9&#125;,0&#123;10..99&#125;,100&#125;</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">ls</span> ./playground</span><br><span class="line">dir-001  ...  dir-100</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">touch</span> ./playground/dir-&#123;00&#123;1..9&#125;,0&#123;10..99&#125;,100&#125;/file-&#123;A..Z&#125;</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">ls</span> ./playground/dir-001</span><br><span class="line">file-A  ...  file-Z</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">ls</span> ./playgrounddir-002</span><br><span class="line">file-A  ...  file-Z</span><br></pre></td></tr></table></figure>

<p><code>tar</code>一个很重要的特性是它在归档时保留了原文档的目录结构。如，若我们在当前目录下归档<code>playground</code>文件夹：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ <span class="built_in">ls</span></span><br><span class="line">foo.txt.gz  playground</span><br><span class="line">[meme@localhost Playground]$ tar cf playground.tar playground</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">ls</span></span><br><span class="line">foo.txt.gz  playground  playground.tar</span><br></pre></td></tr></table></figure>

<p>使用<code>tar tf</code>可以列出归档文件的内容，<code>tar tvf</code>可以列出归档文件的详细内容：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ tar tf playground.tar playground</span><br><span class="line">playground/</span><br><span class="line">playground/dir-001/</span><br><span class="line">playground/dir-001/file-A</span><br><span class="line">playground/dir-001/file-B</span><br><span class="line">...</span><br><span class="line">[meme@localhost Playground]$ tar tvf playground.tar playground</span><br><span class="line">drwxrwxr-x meme/meme     0 2023-07-31 01:25 playground/</span><br><span class="line">drwxrwxr-x meme/meme     0 2023-07-31 01:30 playground/dir-001/</span><br><span class="line">-rw-rw-r-- meme/meme     0 2023-07-31 01:28 playground/dir-001/file-A</span><br><span class="line">-rw-rw-r-- meme/meme     0 2023-07-31 01:28 playground/dir-001/file-B</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>若我们使用同样的命令，但是将待归档文件夹的路径更改为其绝对路径，则其归档文件的结构也将是绝对路径的结构：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ <span class="built_in">pwd</span></span><br><span class="line">/home/meme/Playground</span><br><span class="line">[meme@localhost Playground]$ tar cf playground2.tar /home/meme/Playground/playground</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">ls</span></span><br><span class="line">foo.txt.gz  playground  playground2.tar  playground.tar</span><br></pre></td></tr></table></figure>

<p>我们不妨将<code>playground.tar</code>和<code>playground2.tar</code>用<code>tar xf</code>同时提取在新建文件夹<code>foo</code>中：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ <span class="built_in">mkdir</span> foo</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">cd</span> foo</span><br><span class="line">[meme@localhost foo]$ tar xf ../playground.tar</span><br><span class="line">[meme@localhost foo]$ tar xf ../playground2.tar</span><br><span class="line">[meme@localhost foo]$ <span class="built_in">ls</span> ./playground</span><br><span class="line">dir-001</span><br><span class="line">...</span><br><span class="line">dir-100</span><br><span class="line">[meme@localhost foo]$ <span class="built_in">ls</span> ./home/meme/Playground/playground</span><br><span class="line">dir-001</span><br><span class="line">...</span><br><span class="line">dir-100</span><br></pre></td></tr></table></figure>

<p>可见，<code>playground.tar</code>和<code>playground2.tar</code>内部的内容分别按相对路径和绝对路径的目录结构存储。对<code>playground.tar</code>，是<code>playground/</code>；对<code>playground2.tar</code>则是<code>home/meme/Playground/playground/</code>。这样的设计可以保证我们归档目录结构与原目录结构的完全统一，使得我们可以在任何地方抽取归档文件。比如，<code>playground2.tar</code>就可以完全在另一台主机的根目录下抽取，使得其在新主机的路径仍为<code>home/meme/Playground/playground</code>。</p>
<p>需要注意的是，<code>tar xf</code>默认抽取所有文件，但是若其后面有指定的文件路径，则其只会抽取指定文件，如，此处我们先删除<code>home</code>，再只从<code>playground2.tar</code>中抽取一个目录<code>dir-001</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost foo]$ <span class="built_in">ls</span></span><br><span class="line">home  playground</span><br><span class="line">[meme@localhost foo]$ <span class="built_in">rm</span> -r home</span><br><span class="line">[meme@localhost foo]$ <span class="built_in">ls</span></span><br><span class="line">playground</span><br><span class="line">[meme@localhost foo]$ tar xf ../playground2.tar home/meme/Playground/playground/dir-001</span><br><span class="line">[meme@localhost foo]$ <span class="built_in">ls</span></span><br><span class="line">home  playground</span><br><span class="line">[meme@localhost foo]$ <span class="built_in">ls</span> ./home/meme/Playground/playground</span><br><span class="line">dir-001</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在有些版本的Linux发行版中，在命令的<code>.tar</code>文件名后加入<code>--wildcards</code>可以使得我们的路径能支持通配符，但是路径最好用引号引起。</p>
<p>已抽出文件不会继承打包文件的权限，其只拥有将其抽出的用户的权限，也就是说，抽出文件的拥有者是抽取人，除非打包文件的是根用户。</p>
</blockquote>
<h4 id="与find的结合"><a href="#与find的结合" class="headerlink" title="与find的结合"></a>与<code>find</code>的结合</h4><p>由于<code>find</code>搜索指定文件夹中的文件时给出的搜索结果是相对于该文件夹的相对路径，因此<code>tar</code>常常可以与<code>find</code>结合使用，使得<code>find</code>的搜索结果可以作为<code>tar</code>的待归档文件，并用<code>tar rf</code>直接在原归档文件的基础上增加新内容，如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ find playground -name <span class="string">&#x27;file-A&#x27;</span></span><br><span class="line">playground/dir-001/file-A</span><br><span class="line">playground/dir-002/file-A</span><br><span class="line">...</span><br><span class="line">playground/dir-099/file-A</span><br><span class="line">playground/dir-100/file-A</span><br><span class="line">[meme@localhost Playground]$ find playground -name <span class="string">&#x27;file-A&#x27;</span> -<span class="built_in">exec</span> tar rf playground.tar <span class="string">&#x27;&#123;&#125;&#x27;</span> <span class="string">&#x27;+&#x27;</span></span><br><span class="line">[meme@localhost Playground]$ tar tf playground.tar</span><br><span class="line">playground/</span><br><span class="line">playground/dir-001/</span><br><span class="line">playground/dir-001/file-A</span><br><span class="line">playground/dir-001/file-B</span><br><span class="line">...</span><br><span class="line">playground/dir-100/file-Z</span><br><span class="line">playground/dir-001/file-A</span><br><span class="line">playground/dir-002/file-A</span><br><span class="line">...</span><br><span class="line">playground/dir-099/file-A</span><br><span class="line">playground/dir-100/file-A</span><br></pre></td></tr></table></figure>

<p>将直接将所有的<code>file-A</code>文件归档、增加至<code>playground.tar</code>中。</p>
<h4 id="与标准输入和输出结合"><a href="#与标准输入和输出结合" class="headerlink" title="与标准输入和输出结合"></a>与标准输入和输出结合</h4><p>通常地，<code>tar cf [FILE.tar] [PATH]</code>不会产生输出，而是直接生成<code>FILE.tar</code>文件，但是，若我们将<code>[FILE.tar]</code>替换为<code>-</code>，则上述指令会将归档文件包以<strong>标准输出的形式输出</strong>；同样地，<code>tar xf [FILE.tar]</code>不会接受输入，只会生成提取文件，而我们若将<code>[FILE.tar]</code>替换为<code>-</code>，则<code>tar xf</code>会<strong>接受标准输入的输入</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost foo]$ <span class="built_in">ls</span></span><br><span class="line">home  playground</span><br><span class="line">[meme@localhost foo]$ <span class="built_in">rm</span> -r playground</span><br><span class="line">[meme@localhost foo]$ <span class="built_in">ls</span></span><br><span class="line">home</span><br><span class="line">[meme@localhost foo]$ tar cf - ../playground | tar xf -</span><br><span class="line">[meme@localhost foo]$ <span class="built_in">ls</span></span><br><span class="line">home  playground</span><br></pre></td></tr></table></figure>

<p>上述命令将<code>tar cf</code>对<code>../playground</code>的归档输出到<code>-</code>标准输出中，该标准输出又被管道至<code>tar xf</code>的<code>-</code>标准输入，<code>tar xf</code>将<code>-</code>提取，于是我们就在当前文件夹得到父文件夹的<code>playground</code>文件夹。</p>
<blockquote>
<p><code>-</code>代替标准输入、输出的惯例被很多程序使用。</p>
</blockquote>
<p>由此，前面<code>find</code>与<code>tar</code>的结合也可以通过管道<code>|</code>进行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ <span class="built_in">ls</span></span><br><span class="line">foo  foo.txt.gz  playground  playground2.tar</span><br><span class="line">[meme@localhost Playground]$ find playground -name <span class="string">&#x27;file-A&#x27;</span> | tar cf playground.tar -T-</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">ls</span></span><br><span class="line">foo  foo.txt.gz  playground  playground2.tar  playground.tar</span><br><span class="line">[meme@localhost Playground]$ tar tf playground.tar</span><br><span class="line">playground/dir-001/file-A</span><br><span class="line">playground/dir-002/file-A</span><br><span class="line">...</span><br><span class="line">playground/dir-099/file-A</span><br><span class="line">playground/dir-100/file-A</span><br></pre></td></tr></table></figure>

<p><code>-T</code>全称<code>--file-from</code>，它将导致<code>tar</code>从一个文件（此处为标准输出文件）而不是命令行中读入路径名，<code>-T</code>后面的<code>-</code>示意该文件为管道过来的<strong>标准输入文件</strong>。最终整个命令达到的效果就是将<code>playground</code>中所有的<code>file-A</code>文件归档。</p>
<blockquote>
<p><code>-T-</code>可以用<code>--file-from=-</code>代替。</p>
</blockquote>
<h4 id="tgz和-tbz"><a href="#tgz和-tbz" class="headerlink" title=".tgz和.tbz"></a><code>.tgz</code>和<code>.tbz</code></h4><p><code>tar czf [FILE.tgz] [PATH]</code>和<code>tar cjf [FILE.tbz] [PATH]</code>将分别把得到的<code>.tar</code>文件一步压缩为<code>.tgz</code>或<code>.tbz</code>文件，此处不再赘述。</p>
<h3 id="zip：打包与压缩"><a href="#zip：打包与压缩" class="headerlink" title="zip：打包与压缩"></a><code>zip</code>：打包与压缩</h3><p><code>zip</code>更常用于Windows系统中。相比于<code>tar</code>，<code>zip</code>兼具打包和压缩的功能。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zip [OPTION] [ZIPFILE] [FILE]</span><br></pre></td></tr></table></figure>

<p><code>zip</code>的使用很简单，基本格式为包文件名+待打包文件路径，对于目录文件则要加上<code>-r</code>选项，否则只有目录被存储：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ <span class="built_in">ls</span></span><br><span class="line">foo  foo.txt.gz  playground  playground2.tar  playground.tar</span><br><span class="line">[meme@localhost Playground]$ zip -r dir-001.zip playground/dir-001</span><br><span class="line">  adding: playground/dir-001/ (stored 0%)</span><br><span class="line">  adding: playground/dir-001/file-A (stored 0%)</span><br><span class="line">  ...</span><br><span class="line">  adding: playground/dir-001/file-Z (stored 0%)</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">ls</span></span><br><span class="line">dir-001.zip  foo  foo.txt.gz  playground  playground2.tar  playground.tar</span><br></pre></td></tr></table></figure>

<p>上述指令将<code>playground</code>中的<code>dir-001</code>文件夹打包压缩为<code>dir-001.zip</code>。值得注意的是，<code>zip</code>有压缩功能，<code>stored</code>后的百分比即表示<strong>压缩量</strong>。因为各个<code>file-[A..Z]</code>文件均为空文件，所以没有压缩。</p>
<p><code>zip</code>的打包是更新式的打包而不是替代式的打包，也就是说，若已经存在了文件包<code>xx.zip</code>，再以相同的名字<code>xx.zip</code>打包某群文件不会再生成一个<code>.zip</code>文件，而是在原<code>xx.zip</code>文件包的基础上进行更新，如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ zip -r dir-001.zip playground/dir-002</span><br><span class="line">  adding: playground/dir-002/ (stored 0%)</span><br><span class="line">  ...</span><br><span class="line">  adding: playground/dir-002/file-Z (stored 0%)</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">ls</span></span><br><span class="line">dir-001.zip  foo  foo.txt.gz  playground  playground2.tar  playground.tar</span><br><span class="line">[meme@localhost Playground]$ unzip -l dir-001.zip</span><br><span class="line">Archive:  dir-001.zip</span><br><span class="line">  Length      Date    Time    Name</span><br><span class="line">---------  ---------- -----   ----</span><br><span class="line">        0  07-31-2023 01:30   playground/dir-001/</span><br><span class="line">        ...</span><br><span class="line">        0  07-31-2023 01:28   playground/dir-001/file-Z</span><br><span class="line">        0  07-31-2023 01:30   playground/dir-002/</span><br><span class="line">        ...</span><br><span class="line">        0  07-31-2023 01:28   playground/dir-002/file-Z</span><br><span class="line">---------                     -------</span><br><span class="line">        0                     54 files</span><br></pre></td></tr></table></figure>

<p><code>dir-002</code>直接被加进了<code>dir-001.zip</code>中，类似的操作在<code>tar</code>中要指定<code>r</code>模式。</p>
<p>上面用到的<code>unzip</code>是与<code>zip</code>对应的解压程序。<code>unzip -l [FILE.zip] [PATH]</code>将只列出文件包内某文件的信息，<code>[PATH]</code>缺省则列出所有。而去掉<code>-l</code>则将从包中抽取所有或指定文件。</p>
<blockquote>
<p><code>zip</code>也能结合标准输入输出，此处不再赘述。</p>
</blockquote>
<h2 id="同步与备份文件"><a href="#同步与备份文件" class="headerlink" title="同步与备份文件"></a>同步与备份文件</h2><p>同步与备份，即保持一个或多个目录与另一个本地或远程目录保持同步。常见的<code>git</code>仓库就是一个这样的远程托管同步系统。在Linux中，更常被使用的同步备份工具是<code>rsync</code>，全称Remote Synchronize。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync [OPTION] SOURCE DESTINATION</span><br></pre></td></tr></table></figure>

<p>其中<code>SOURCE</code>是待备份文件（可多个），而<code>DESTINATION</code>是即将存储<code>SOURCE</code>全部文件内容的文件夹，两者必须是下列3个选项之一且至少一个是本地文件&#x2F;目录：</p>
<ul>
<li>一个本地文件&#x2F;目录；</li>
<li>一个远程文件&#x2F;目录，以<code>[user@]host:path</code>的形式存在；</li>
<li>一个远程rsync服务器，由<code>rsync://[user@]host[:port]/path</code>指定。</li>
</ul>
<blockquote>
<p>其中带<code>[]</code>的表示可选项，因此对于远程文件&#x2F;目录，我们只要写上远程主机名<code>host</code>以及存放目录<code>path</code>；对于远程rsync服务器，我们只要写上远程服务器的主机名（url的形式）<code>host</code>及其存放目录<code>path</code>。</p>
</blockquote>
<p>实际使用时，我们一般会用<code>rsync -ac -delete</code>，其中<code>-a</code>表示递归地备份并保护文件属性，<code>-v</code>表示输出备份信息，<code>-delete</code>表示删除备份设备中已经存在但是不存在于源设备中的文件。若<code>SOURCE</code>和<code>DESTINATION</code>中有一个为远程ssh主机，还要增加选项<code>--rsh==ssh</code>。</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul>
<li><a target="_blank" rel="noopener" href="https://www.kancloud.cn/thinkphp/linux-command-line/39446">The Linux Command Line 中文版 第十五章：软件包管理</a></li>
<li><a target="_blank" rel="noopener" href="https://www.kancloud.cn/thinkphp/linux-command-line/39450">The Linux Command Line 中文版 第十九章：归档和备份</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://zclzcl0223.github.io/2023/07/25/PackageProcessing/" data-id="clzik0lcr006nv47kdaya1qp0" data-title="Package Management and Processing" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Tool/" rel="tag">Tool</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-FileSearching" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/25/FileSearching/" class="article-date">
  <time class="dt-published" datetime="2023-07-25T10:19:35.000Z" itemprop="datePublished">2023-07-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Tool/">Tool</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/25/FileSearching/">File Searching</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <span id="more"></span>


<h1 id="locate：通过名字查找文件"><a href="#locate：通过名字查找文件" class="headerlink" title="locate：通过名字查找文件"></a><code>locate</code>：通过名字查找文件</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">locate [OPTION]... [PATTERN]...</span><br></pre></td></tr></table></figure>

<p><code>locate</code>程序会快速地搜索其内部的<strong>路径名数据库</strong>，然后输出每个绝对路径中包含了<code>[PATTERN]</code>的文件的绝对路径。<code>[PATTERN]</code>一般为普通的字符串，但有些版本还会包括正则表达式匹配和通配符匹配。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]<span class="comment"># locate bin/zip</span></span><br><span class="line">/usr/bin/zip</span><br><span class="line">/usr/bin/zipcloak</span><br><span class="line">/usr/bin/zipgrep</span><br><span class="line">/usr/bin/zipinfo</span><br><span class="line">/usr/bin/zipnote</span><br><span class="line">/usr/bin/zipsplit</span><br></pre></td></tr></table></figure>

<p><code>locate</code>的路径名数据库由<code>updatedb</code>程序创建。该程序会在特定的时间间隔（如每次开机）被守护进程<code>cron</code>执行，因此一些新创建的文件可能无法用<code>locate</code>进行搜索，但是我们也可以以超级用户的身份手动运行<code>updatedb</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost Playground]# updatedb</span><br></pre></td></tr></table></figure>

<h1 id="find：在目录层次结构中搜索文件"><a href="#find：在目录层次结构中搜索文件" class="headerlink" title="find：在目录层次结构中搜索文件"></a><code>find</code>：在目录层次结构中搜索文件</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find [path...] [expression]</span><br></pre></td></tr></table></figure>

<p><code>locate</code>可以让我们简单地用文件名找到文件的位置，而<code>find</code>则可以让我们在指定的目录<code>[path]</code>（绝对或相对路径）下，用文件的各种<strong>属性</strong>匹配相应的文件。在了解<code>find</code>之前，我们先在当前目录下创建100个子目录，并在每个子目录下创建24个普通文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ <span class="built_in">mkdir</span> <span class="built_in">dir</span>-&#123;00&#123;1..9&#125;,0&#123;10..99&#125;,100&#125;</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">ls</span></span><br><span class="line">dir-001  ...  dir-100</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">touch</span> <span class="built_in">dir</span>-&#123;00&#123;1..9&#125;,0&#123;10..99&#125;,100&#125;/file-&#123;A..Z&#125;</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">ls</span> dir-001</span><br><span class="line">file-A  ...  file-Z</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">ls</span> dir-002</span><br><span class="line">file-A  ...  file-Z</span><br></pre></td></tr></table></figure>

<p>在最基本的用法里，<code>find</code>会输出所查目录及其子目录的所有文件的路径，其中，相对路径查找输出相对路径，绝对路径查找则输出绝对路径：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ find ./dir-001</span><br><span class="line">./dir-001</span><br><span class="line">...</span><br><span class="line">./dir-001/file-Z</span><br><span class="line">[meme@localhost Playground]$ find /home/meme/Playground/dir-001</span><br><span class="line">/home/meme/Playground/dir-001</span><br><span class="line">...</span><br><span class="line">/home/meme/Playground/dir-001/file-Z</span><br></pre></td></tr></table></figure>

<h2 id="Tests：测试条件"><a href="#Tests：测试条件" class="headerlink" title="Tests：测试条件"></a>Tests：测试条件</h2><p><code>find</code>拥有众多的测试条件，每个测试条件都一定程度上对应着文件的一项属性。<code>find</code>在指定目录中遍历文件元数据时，会使用用户指定的测试条件来筛选文件。</p>
<h3 id="type"><a href="#type" class="headerlink" title="-type"></a><code>-type</code></h3><p><code>-type</code>选择文件的类别：<code>b</code>块设备文件、<code>c</code>字符设备文件、<code>d</code>目录、<code>f</code>普通文件、<code>l</code>符号链接：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ find ./dir-001 -<span class="built_in">type</span> f</span><br><span class="line">./dir-001/file-A</span><br><span class="line">...</span><br><span class="line">./dir-001/file-Z</span><br><span class="line">[meme@localhost Playground]$ find ./dir-001 -<span class="built_in">type</span> d</span><br><span class="line">./dir-001</span><br></pre></td></tr></table></figure>

<h3 id="name"><a href="#name" class="headerlink" title="-name"></a><code>-name</code></h3><p><code>-name</code>选择文件的名字。此处的名字只是名字，而不包含路径：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ find ./dir-001 -name <span class="string">&#x27;*1&#x27;</span></span><br><span class="line">./dir-001</span><br></pre></td></tr></table></figure>

<h3 id="size"><a href="#size" class="headerlink" title="-size"></a><code>-size</code></h3><p><code>-size</code>选择文件的大小，后面跟着的字符串，<code>+1M</code>表示只选择大于1M的文件，<code>-1M</code>表示只选择小于1M的文件，<code>1M</code>表示只选择大小等于1M的文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ find ./dir-001 -size <span class="string">&#x27;1M&#x27;</span></span><br><span class="line">./dir-001</span><br><span class="line">[meme@localhost Playground]$ find ./dir-001 -size <span class="string">&#x27;-1M&#x27;</span></span><br><span class="line">./dir-001/file-A</span><br><span class="line">...</span><br><span class="line">./dir-001/file-Z</span><br></pre></td></tr></table></figure>

<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p>除了上面这三个常用的测试条件，<code>find</code>还支持很多其他的测试条件，如<code>-perm mode</code>选择指定权限<code>mode</code>的文件等。</p>
<h2 id="Operators：操作符"><a href="#Operators：操作符" class="headerlink" title="Operators：操作符"></a>Operators：操作符</h2><p><code>find</code>的测试条件实际上相当于程序语言中的条件语句，因此，它很自然地也能支持各种条件语句的逻辑组合。这些组合与编程语言中的一样，通过逻辑操作符<em>与</em><code>-and</code>、<em>或</em><code>-or</code>、<em>非</em><code>-not</code>来实现。这些逻辑操作符的运算逻辑和执行特性和一般程序语言中的没有任何区别。通常地，逻辑操作符连接的两个测试条件应该分别用<code>()</code>括起来。在命令行中，<code>()</code>有特殊的意义，因此实际上要为<code>()</code>加上转义字符，即实际应使用<code>\(\)</code>。</p>
<ul>
<li><code>-and</code>：<code>find</code>的默认操作符，即若测试条件之间没有操作符，那么其连接符号默认是<code>-and</code>。<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ find . -<span class="built_in">type</span> f -name <span class="string">&#x27;*A&#x27;</span></span><br><span class="line"> ./dir-001/file-A</span><br><span class="line"> ...</span><br><span class="line"> ./dir-100/file-A</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ find . \( -<span class="built_in">type</span> f \) -and \( -name <span class="string">&#x27;*A&#x27;</span> \)</span><br><span class="line">./dir-001/file-A</span><br><span class="line">...</span><br><span class="line">./dir-100/file-A</span><br></pre></td></tr></table></figure>
上面两个命令是等价的。</li>
<li><code>-or</code>：表<em>或</em>，用法与<code>-and</code>相同。</li>
<li><code>-not</code>：表<em>非</em>，用在想要取<em>非</em>的测试条件之前。<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ find ./dir-001 -not -<span class="built_in">type</span> f</span><br><span class="line">./dir-001</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Actions：行为"><a href="#Actions：行为" class="headerlink" title="Actions：行为"></a>Actions：行为</h2><p><code>find</code>允许用户对筛选结果立即进行操作，即，将筛选结果作为其他<strong>命令</strong>的输入参数。</p>
<ul>
<li><code>-delete</code>：删除当前匹配到的文件；</li>
<li><code>-ls</code>：对当前匹配到的文件执行<code>ls</code>操作；</li>
<li><code>-print</code>：将当前匹配文件的路径打印出来，是<code>find</code>的默认操作；</li>
<li><code>-quit</code>：一旦找到一个匹配项就退出。</li>
</ul>
<p>以上四个是<code>find</code>内部自带的操作，如<code>-delete</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ find ./dir-001 -<span class="built_in">type</span> f -delete</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">ls</span> ./dir-001</span><br></pre></td></tr></table></figure>

<blockquote>
<p>需要注意的是，<code>Tests</code>和<code>Actions</code>在<code>find</code>看来是同优先级的，而<code>find</code>又是顺序过滤的，因此不同的<code>Tests</code>和<code>Actions</code>的顺序很重要。</p>
</blockquote>
<h3 id="用户自定义行为"><a href="#用户自定义行为" class="headerlink" title="用户自定义行为"></a>用户自定义行为</h3><p>除了<code>find</code>自带的这几种行为，<code>find</code>还允许用户自由地使用所有合法的Linux命令，一般的格式为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-<span class="built_in">exec</span> [<span class="built_in">command</span>] <span class="string">&#x27;&#123;&#125;&#x27;</span> <span class="string">&#x27;;&#x27;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>因为<code>&#123;&#125;</code>和<code>;</code>在命令行中有特殊意义，所以必须被引用为字符串或者转义。</p>
</blockquote>
<p>如，对筛选出来的文件使用<code>rm -r</code>操作：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ find . -name <span class="string">&#x27;*1&#x27;</span></span><br><span class="line">./dir-001</span><br><span class="line">...</span><br><span class="line">./dir-091</span><br><span class="line">[meme@localhost Playground]$ find . -name <span class="string">&#x27;*1&#x27;</span> -<span class="built_in">exec</span> <span class="built_in">rm</span> -r <span class="string">&#x27;&#123;&#125;&#x27;</span> <span class="string">&#x27;;&#x27;</span></span><br><span class="line">find: <span class="string">&#x27;./dir-001&#x27;</span>: No such file or directory</span><br><span class="line">...</span><br><span class="line">find: <span class="string">&#x27;./dir-091&#x27;</span>: No such file or directory</span><br></pre></td></tr></table></figure>

<p>有时为了安全起见，我们会想要一个个地确认<code>Actions</code>的效果，此时我们可以使用<code>-ok</code>来代替<code>-exec</code>。使用<code>-ok</code>后，<code>[command]</code>在执行前会先向用户进行确认：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ find . -name <span class="string">&#x27;*2&#x27;</span> -ok <span class="built_in">rm</span> -r <span class="string">&#x27;&#123;&#125;&#x27;</span> <span class="string">&#x27;;&#x27;</span></span><br><span class="line">&lt; <span class="built_in">rm</span> ... ./dir-002 &gt; ? n</span><br><span class="line">&lt; <span class="built_in">rm</span> ... ./dir-012 &gt; ? n</span><br><span class="line">&lt; <span class="built_in">rm</span> ... ./dir-022 &gt; ? n</span><br><span class="line">&lt; <span class="built_in">rm</span> ... ./dir-032 &gt; ? y</span><br><span class="line">find: <span class="string">&#x27;./dir-032&#x27;</span>: No such file or directory</span><br><span class="line">&lt; <span class="built_in">rm</span> ... ./dir-042 &gt; ? n</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>当我们使用<code>&#39;;&#39;</code>时，我们在告诉<code>find</code>：对于每一个匹配的文件，运行一次<code>[command]</code>，这样会导致当匹配结果有$n$个文件时，<code>[command]</code>被运行$n$次。要想避免这种情况，我们可以将<code>&#39;;&#39;</code>替换为<code>+</code>，这样就是在告诉<code>find</code>：将所有的结果合成一个列表再执行命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ find . -name <span class="string">&#x27;*2&#x27;</span> -<span class="built_in">exec</span> <span class="built_in">rm</span> -r <span class="string">&#x27;&#123;&#125;&#x27;</span> +</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意，此时只能用<code>-exec</code>而不能用<code>-ok</code>。</p>
</blockquote>
<h1 id="辅助命令"><a href="#辅助命令" class="headerlink" title="辅助命令"></a>辅助命令</h1><p>有许多的辅助命令能够让<code>locate</code>和<code>find</code>的功能更强大。</p>
<h2 id="xargs"><a href="#xargs" class="headerlink" title="xargs"></a><code>xargs</code></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xargs [OPTION]... COMMAND INITIAL-ARGS...</span><br></pre></td></tr></table></figure>

<p><code>xargs</code>从标准输入中接受输入，并将输入转换为一个<em>命令行参数列表</em>，这个参数列表可以直接作为其他指令的参数，如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ find . -name <span class="string">&#x27;*13&#x27;</span></span><br><span class="line">./dir-013</span><br><span class="line">[meme@localhost Playground]$ find . -name <span class="string">&#x27;*13&#x27;</span> | xargs <span class="built_in">ls</span> -l</span><br><span class="line">total 0</span><br><span class="line">-rw-rw-r--. 1 meme meme 0 Jul 26 19:50 file-A</span><br><span class="line">...</span><br><span class="line">-rw-rw-r--. 1 meme meme 0 Jul 26 19:50 file-Z</span><br></pre></td></tr></table></figure>

<p><code>xargs</code>将<code>./dir-013</code>管道为了<code>ls -l</code>的命令行参数。</p>
<h2 id="touch"><a href="#touch" class="headerlink" title="touch"></a><code>touch</code></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">touch [OPTION]... FILE...</span><br></pre></td></tr></table></figure>

<p>当<code>touch</code>后的文件不存在时，<code>touch</code>相当于一个创建文件操作：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ locate taylor</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">touch</span> taylor</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">ls</span> taylor</span><br><span class="line">taylor</span><br></pre></td></tr></table></figure>

<p>若文件已存在，则<code>touch</code>会将其修改时间设置为当前时间：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ <span class="built_in">stat</span> taylor</span><br><span class="line">  File: ‘taylor’</span><br><span class="line">...</span><br><span class="line">Access: 2023-07-26 22:32:26.809464671 -0700</span><br><span class="line">Modify: 2023-07-26 22:32:26.809464671 -0700</span><br><span class="line">Change: 2023-07-26 22:32:26.809464671 -0700</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">touch</span> taylor</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">stat</span> taylor</span><br><span class="line">  File: ‘taylor’</span><br><span class="line">...</span><br><span class="line">Access: 2023-07-26 22:33:54.850140719 -0700</span><br><span class="line">Modify: 2023-07-26 22:33:54.850140719 -0700</span><br><span class="line">Change: 2023-07-26 22:33:54.850140719 -0700</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>stat</code>相当于加强版的<code>ls</code>。</p>
</blockquote>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul>
<li><a target="_blank" rel="noopener" href="https://www.kancloud.cn/thinkphp/linux-command-line/39449">The Linux Command Line 中文版 第十八章：查找文件</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://zclzcl0223.github.io/2023/07/25/FileSearching/" data-id="clzik0lc90027v47k6xh1f2wu" data-title="File Searching" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Tool/" rel="tag">Tool</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-TextFileDataWrangling" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/25/TextFileDataWrangling/" class="article-date">
  <time class="dt-published" datetime="2023-07-25T10:18:40.000Z" itemprop="datePublished">2023-07-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Tool/">Tool</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/25/TextFileDataWrangling/">Text, File and Data Wrangling</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <span id="more"></span>

<h1 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h1><p>下面这些常用的命令可以帮助我们快速地处理文本、在文件中传递信息、进行数据整理。</p>
<h2 id="I-x2F-O重定向"><a href="#I-x2F-O重定向" class="headerlink" title="I&#x2F;O重定向"></a>I&#x2F;O重定向</h2><p>与C语言中的I&#x2F;O重定向相同，Linux的I&#x2F;O重定向允许我们自由地更改标准输入、标准输出和标准错误文件。它们的默认对象分别为键盘、显示器和显示器，文件句柄为0，1和2。</p>
<h3 id="gt-and-gt-gt-：输出重定向"><a href="#gt-and-gt-gt-：输出重定向" class="headerlink" title="&gt; and &gt;&gt;：输出重定向"></a><code>&gt;</code> and <code>&gt;&gt;</code>：输出重定向</h3><p><code>&gt;</code>重定向符允许我们将程序的输出重定向到指定的文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ <span class="built_in">ls</span> -l /dev/null</span><br><span class="line">crw-rw-rw-. 1 root root 1, 3 Jul 25 18:19 /dev/null</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">ls</span> -l /dev/null &gt; ls-output.txt</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">cat</span> ls-output.txt</span><br><span class="line">crw-rw-rw-. 1 root root 1, 3 Jul 25 18:19 /dev/null</span><br></pre></td></tr></table></figure>

<blockquote>
<p>将<code>cat</code>视作一个查看文件内容的命令即可，后面会有介绍。</p>
</blockquote>
<p>使用<code>&gt;</code>后，原本会被输出到显示器的信息被输出到了新文件<code>ls-output.txt</code>中。需要注意的是，作为重定向目标的文件如果不存在，则Linux会先在当前目录下创建该文件，若目标文件已存在，则Linux会先将文件内容清空：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ &gt; ls-output.txt</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">cat</span> ls-output.txt</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">ls</span> -l ls-output.txt</span><br><span class="line">-rw-rw-r--. 1 meme meme 0 Jul 25 19:52 ls-output.txt</span><br></pre></td></tr></table></figure>

<p>由于<code>&gt;</code>前没有程序输出，所以目标文件的内容会被直接清零。若想保持原文件内容不变，则应该使用<code>&gt;&gt;</code>重定向符，让输出被添加在目标文件末尾：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ <span class="built_in">ls</span> -l /dev/null &gt;&gt; ls-output.txt</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">cat</span> ls-output.txt</span><br><span class="line">crw-rw-rw-. 1 root root 1, 3 Jul 25 18:19 /dev/null</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">ls</span> -l /dev/null &gt;&gt; ls-output.txt</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">cat</span> ls-output.txt</span><br><span class="line">crw-rw-rw-. 1 root root 1, 3 Jul 25 18:19 /dev/null</span><br><span class="line">crw-rw-rw-. 1 root root 1, 3 Jul 25 18:19 /dev/null</span><br></pre></td></tr></table></figure>

<blockquote>
<p>此处用到的文件<code>/dev/null</code>是Linux中的一个特殊文件，它是一个系统设备，称“位存储桶”，它可以接受输入，但是不输入任何东西。有时一些输出信息如果我们不想看到，我们可以直接把它们重定向到<code>/dev/null</code>。</p>
</blockquote>
<h3 id="标准错误重定向"><a href="#标准错误重定向" class="headerlink" title="标准错误重定向"></a>标准错误重定向</h3><p>标准错误显示的是程序执行过程中出现的错误信息，比如，若我们想用<code>ls</code>查看一个不存在的文件夹的信息，<code>ls</code>输出的就是标准错误：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ <span class="built_in">ls</span> -l /ddd/ds</span><br><span class="line"><span class="built_in">ls</span>: cannot access /ddd/ds: No such file or directory</span><br></pre></td></tr></table></figure>

<p>标准错误缺乏专用的重定向符，我们只能用文件句柄+输出重定向来实现对标准错误的重定向，即：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ <span class="built_in">ls</span> -l /ddd/ds 2&gt; ls-output-error.txt</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">cat</span> ls-output-error.txt</span><br><span class="line"><span class="built_in">ls</span>: cannot access /ddd/ds: No such file or directory</span><br></pre></td></tr></table></figure>

<p><code>2</code>是Linux内部的标准错误文件句柄，<code>2&gt;</code>或<code>2&gt;&gt;</code>（添加到文件末尾）能够实现标准错误的重定向。</p>
<h3 id="标准输出与错误同步"><a href="#标准输出与错误同步" class="headerlink" title="标准输出与错误同步"></a>标准输出与错误同步</h3><p>有时，我们会希望将标准输出和标准错误都重定向到一个文件。对于这个操作，Linux提供了两种方式。</p>
<ol>
<li>在输出重定向后将标准错误重定向到标准输出：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ <span class="built_in">ls</span> -l /ddd/ds &gt;&gt; ls-output-error.txt 2&gt;&amp;1</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">cat</span> ls-output-error.txt</span><br><span class="line"><span class="built_in">ls</span>: cannot access /ddd/ds: No such file or directory</span><br><span class="line"><span class="built_in">ls</span>: cannot access /ddd/ds: No such file or directory</span><br></pre></td></tr></table></figure>
上面的<code>2&gt;&amp;1</code>将标准错误<code>2</code>重定向至标准输出<code>1</code>，而前面的<code>&gt;&gt;</code>则同时决定了两者的重定向方式。<code>&gt;&gt;</code>和<code>2&gt;&amp;1</code>的顺序不能颠倒，否则标准错误会被先重定向到原来的标准输出（显示器）。</li>
<li>标准输出与标准错误同时重定向，这是一种更简洁的方法：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ <span class="built_in">ls</span> -l /ddd/ds &amp;&gt; ls-output-error.txt</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">cat</span> ls-output-error.txt</span><br><span class="line"><span class="built_in">ls</span>: cannot access /ddd/ds: No such file or directory</span><br></pre></td></tr></table></figure>
<code>&amp;&gt;</code>或<code>&amp;&gt;&gt;</code>同时将标准输出和标准错误重定向到同一个文件。</li>
</ol>
<h3 id="lt-：输入重定向"><a href="#lt-：输入重定向" class="headerlink" title="&lt;：输入重定向"></a><code>&lt;</code>：输入重定向</h3><p>在了解<code>&lt;</code>输入重定向符号之前，我们要先知道一个可以接受标准输入的命令，见<a href="/2023/07/25/TextFileDataWrangling/#cat：Concatenate，连接文件"><code>cat</code>：Concatenate，连接文件</a>。</p>
<p>既然<code>cat</code>能够接受标准输入，那么我们就可以用<code>&lt;</code>将标准输入重定向为我们想要的文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ <span class="built_in">cat</span> &lt; ls-output.txt</span><br><span class="line">crw-rw-rw-. 1 root root 1, 3 Jul 25 18:19 /dev/null</span><br><span class="line">crw-rw-rw-. 1 root root 1, 3 Jul 25 18:19 /dev/null</span><br></pre></td></tr></table></figure>

<p>进一步地，可以同时进行输入和输出重定向：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ <span class="built_in">cat</span> &lt; ls-output.txt &gt; ls-output-copy.txt</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">cat</span> ls-output-copy.txt</span><br><span class="line">crw-rw-rw-. 1 root root 1, 3 Jul 25 18:19 /dev/null</span><br><span class="line">crw-rw-rw-. 1 root root 1, 3 Jul 25 18:19 /dev/null</span><br></pre></td></tr></table></figure>

<h2 id="cat：Concatenate，连接文件"><a href="#cat：Concatenate，连接文件" class="headerlink" title="cat：Concatenate，连接文件"></a><code>cat</code>：Concatenate，连接文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> [OPTION]... [FILE]...</span><br></pre></td></tr></table></figure>

<p><code>cat</code>，如其字面意思，是一个连接操作。它将依次读取输入文件<code>[FILE]</code>的内容，并复制到标准输出。由于<code>cat</code>输出的不同文件的内容之间不会分页，也不会有分隔符，所以如果此时把输出重定向到另一个文件，那么其作用就好像是把这几个文件拼合成了一个文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ <span class="built_in">cat</span> ls-output.txt</span><br><span class="line">crw-rw-rw-. 1 root root 1, 3 Jul 25 18:19 /dev/null</span><br><span class="line">crw-rw-rw-. 1 root root 1, 3 Jul 25 18:19 /dev/null</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">cat</span> ls-output.txt ls-output-error.txt</span><br><span class="line">crw-rw-rw-. 1 root root 1, 3 Jul 25 18:19 /dev/null</span><br><span class="line">crw-rw-rw-. 1 root root 1, 3 Jul 25 18:19 /dev/null</span><br><span class="line"><span class="built_in">ls</span>: cannot access /ddd/ds: No such file or directory</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">cat</span> ls-output.txt ls-output-error.txt &gt; ls-output-cat.txt</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">cat</span> ls-output-cat.txt</span><br><span class="line">crw-rw-rw-. 1 root root 1, 3 Jul 25 18:19 /dev/null</span><br><span class="line">crw-rw-rw-. 1 root root 1, 3 Jul 25 18:19 /dev/null</span><br><span class="line"><span class="built_in">ls</span>: cannot access /ddd/ds: No such file or directory</span><br></pre></td></tr></table></figure>

<p><code>cat</code>后面也可以不跟文件名，此时它将从标准输入中读取信息并复制到标准输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ <span class="built_in">cat</span></span><br><span class="line">I don<span class="string">&#x27;t know about you but I&#x27;</span>m feeling 22.</span><br><span class="line">I don<span class="string">&#x27;t know about you but I&#x27;</span>m feeling 22.</span><br></pre></td></tr></table></figure>

<p>上面的指令中，我只输入了一次<code>I don&#39;t know about you but I&#39;m feeling 22.</code>，但是回车后<code>cat</code>将会复制并再次输出一行相同的文本，直到我们<code>Ctrl+D</code>示意标准输入已经到达文件末尾。当然，我们也可以将<code>cat</code>输出的标准输入内容重定向到指定文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ <span class="built_in">cat</span> &gt; 22.txt</span><br><span class="line">I don<span class="string">&#x27;t know about you but I&#x27;</span>m feeling 22.</span><br><span class="line">Everything will be alright <span class="keyword">if</span> you keep me next to you.</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">cat</span> 22.txt</span><br><span class="line">I don<span class="string">&#x27;t know about you but I&#x27;</span>m feeling 22.</span><br><span class="line">Everything will be alright <span class="keyword">if</span> you keep me next to you.</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>cat</code>有许多有趣的<code>[OPTION]</code>选项，如<code>-n</code>会给输出加入行号。用<code>cat --help</code>来查看更多有趣的选项操作。</p>
</blockquote>
<h3 id="Here-document"><a href="#Here-document" class="headerlink" title="Here-document"></a>Here-document</h3><p>Here-document是Shell中一种特殊形式的重定向。Here-document，可以解释为“立即文档”。在这种特殊形式的重定向中，Here-document就是一段字符串，这段字符串的长度很短，以至于将其单独放在一个文件中有点“大动干戈”，不如直接放在命令或者脚本代码中。Here-document的基本用法为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="built_in">command</span>] &lt;&lt; [Here Tag]</span><br><span class="line">[Your Here-document]</span><br><span class="line">[Here Tag] <span class="comment"># 终止符[Here Tag]必须独占一行，且要顶格写</span></span><br></pre></td></tr></table></figure>

<p>其中<code>[command]</code>是任意的能够接受输入文档的指令，<code>[Your Here-document]</code>是用户想要输入的字符串，<code>[Here Tag]</code>则用于标志用户输入的开始和终止，可以是任何的字符串，一般用<code>EOF</code>。以<code>cat</code>为例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ <span class="built_in">cat</span> &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">&gt; Hello World</span></span><br><span class="line"><span class="string">&gt; EOF</span></span><br><span class="line">Hello World</span><br></pre></td></tr></table></figure>

<p>此时，<code>Hello World</code>充当了输入文件的内容。</p>
<blockquote>
<p>Here-document常被用于Bash脚本中。</p>
</blockquote>
<h2 id="：管道线"><a href="#：管道线" class="headerlink" title="|：管道线"></a><code>|</code>：管道线</h2><p><code>|</code>运算符可用于连接两个命令，它会自动地将前一个命令的输出管道为后一个命令的输入：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ <span class="built_in">cat</span> 22.txt | <span class="built_in">cat</span> &gt;&gt; 22.txt</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">cat</span> 22.txt</span><br><span class="line">I don<span class="string">&#x27;t know about you but I&#x27;</span>m feeling 22.</span><br><span class="line">Everything will be alright <span class="keyword">if</span> you keep me next to you.</span><br><span class="line">I don<span class="string">&#x27;t know about you but I&#x27;</span>m feeling 22.</span><br><span class="line">Everything will be alright <span class="keyword">if</span> you keep me next to you.</span><br></pre></td></tr></table></figure>

<p>第一个<code>cat</code>输出<code>22.txt</code>的内容，<code>|</code>将其管道为第二个<code>cat</code>的输入，而第二个<code>cat</code>的输出又被重定向到<code>22.txt</code>，因此最后<code>22.txt</code>的前两行被复制了一份。</p>
<blockquote>
<p>管道线可以用来实现很复杂的操作。有时会把多个命令用多个<code>|</code>连接，这样形成的复合命令一般被称为“过滤器”，因为它可以把原始的输出通过<code>|</code>的逐层过滤得到我们想要的输出形式。</p>
</blockquote>
<h2 id="uniq：Unique，报道或忽略重复行"><a href="#uniq：Unique，报道或忽略重复行" class="headerlink" title="uniq：Unique，报道或忽略重复行"></a><code>uniq</code>：Unique，报道或忽略重复行</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">uniq</span> [OPTION]... [INPUT [OUTPUT]]</span><br></pre></td></tr></table></figure>

<p><code>uniq</code>从标准输入或者单个文件名参数中接受<strong>有序列表</strong>，并在默认情况下删除有序列表中任何重复的行。由于输入<code>uniq</code>的参数必须是有序的<code>uniq</code>才能其作用（因为它只能检测到连续重复的行），因此<code>uniq</code>通常会结合<code>sort</code>一起使用：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ <span class="built_in">cat</span> 22.txt</span><br><span class="line">I don<span class="string">&#x27;t know about you but I&#x27;</span>m feeling 22.</span><br><span class="line">Everything will be alright <span class="keyword">if</span> you keep me next to you.</span><br><span class="line">I don<span class="string">&#x27;t know about you but I&#x27;</span>m feeling 22.</span><br><span class="line">Everything will be alright <span class="keyword">if</span> you keep me next to you.</span><br><span class="line">You don<span class="string">&#x27;t know about me but I&#x27;</span>ll bet you want to.</span><br><span class="line">Everything will be alright <span class="keyword">if</span> we just keep dancing like we<span class="string">&#x27;re</span></span><br><span class="line"><span class="string">22 22</span></span><br><span class="line"><span class="string">[meme@localhost Playground]$ cat 22.txt | sort | uniq</span></span><br><span class="line"><span class="string">22 22</span></span><br><span class="line"><span class="string">Everything will be alright if we just keep dancing like we&#x27;</span>re</span><br><span class="line">Everything will be alright <span class="keyword">if</span> you keep me next to you.</span><br><span class="line">I don<span class="string">&#x27;t know about you but I&#x27;</span>m feeling 22.</span><br><span class="line">You don<span class="string">&#x27;t know about me but I&#x27;</span>ll bet you want to.</span><br></pre></td></tr></table></figure>

<blockquote>
<p>此处稍稍增添了点《22》的歌词。</p>
</blockquote>
<p>选项<code>-d</code>会使得<code>uniq</code>只输出重复的行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ <span class="built_in">cat</span> 22.txt | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -d</span><br><span class="line">Everything will be alright <span class="keyword">if</span> you keep me next to you.</span><br><span class="line">I don<span class="string">&#x27;t know about you but I&#x27;</span>m feeling 22.</span><br></pre></td></tr></table></figure>

<h2 id="wc：Word-Count，打印行、单词和字节数"><a href="#wc：Word-Count，打印行、单词和字节数" class="headerlink" title="wc：Word Count，打印行、单词和字节数"></a><code>wc</code>：Word Count，打印行、单词和字节数</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">wc</span> [OPTION]... [FILE]...</span><br></pre></td></tr></table></figure>

<p><code>wc</code>会统计标准输入或者文件内容的总行数、总单词数和总字节数（字符数）并输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ <span class="built_in">cat</span> 22.txt | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -d | <span class="built_in">wc</span></span><br><span class="line">      2      20      98</span><br></pre></td></tr></table></figure>

<p><code>wc</code>默认会将三个数字一起输出，不过<code>-l</code>、<code>-w</code>、<code>-m</code>选项会让其分别只输出行、单词、字符数。</p>
<h2 id="head-x2F-tail：打印文件的开头或结尾"><a href="#head-x2F-tail：打印文件的开头或结尾" class="headerlink" title="head&#x2F;tail：打印文件的开头或结尾"></a><code>head</code>&#x2F;<code>tail</code>：打印文件的开头或结尾</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">head</span>/tail [OPTION]... [FILE]...</span><br></pre></td></tr></table></figure>

<p><code>head</code>和<code>tail</code>是两个对称的命令，前者默认输出输入的前10行，后者输出输入的后10行。<code>-n</code>选项可用于调整打印的行数：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ <span class="built_in">cat</span> 22.txt | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -d | <span class="built_in">head</span> -n1</span><br><span class="line">Everything will be alright <span class="keyword">if</span> you keep me next to you.</span><br></pre></td></tr></table></figure>

<blockquote>
<p>若在使用<code>tail</code>的同时使用<code>-f</code>选项，那么除非人为地中止，<code>tail</code>程序不会退出。这使得我们可以用<code>tail -f [FILE]</code>来实时的监测文件内容。</p>
</blockquote>
<h2 id="tee：T-splitter，左右开弓"><a href="#tee：T-splitter，左右开弓" class="headerlink" title="tee：T-splitter，左右开弓"></a><code>tee</code>：T-splitter，左右开弓</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">tee</span> [OPTION]... [FILE]...</span><br></pre></td></tr></table></figure>

<p><code>tee</code>，如其名字的由来，T型分流器（T-splitter），可以接受标准输入读入的数据，并将其同时复制到标准输出和一个或多个文件中：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ <span class="built_in">cat</span> 22.txt | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -d | <span class="built_in">tee</span> t1.txt t2.txt | <span class="built_in">head</span> -n1</span><br><span class="line">Everything will be alright <span class="keyword">if</span> you keep me next to you.</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">cat</span> t1.txt</span><br><span class="line">Everything will be alright <span class="keyword">if</span> you keep me next to you.</span><br><span class="line">I don<span class="string">&#x27;t know about you but I&#x27;</span>m feeling 22.</span><br><span class="line">[meme@localhost Playground]$ <span class="built_in">cat</span> t2.txt</span><br><span class="line">Everything will be alright <span class="keyword">if</span> you keep me next to you.</span><br><span class="line">I don<span class="string">&#x27;t know about you but I&#x27;</span>m feeling 22.</span><br></pre></td></tr></table></figure>

<p><code>tee</code>获取了<code>uniq</code>的输出，并将其输出到<code>t1.txt</code>和<code>t2.txt</code>中，同时还会输入到标准输出中。<code>tee</code>的这种不中断管道流的特性使得它很适合被用在过滤器中以提取中间信息。</p>
<h2 id="grep：Global-Regular-Expression-Print，打印匹配行"><a href="#grep：Global-Regular-Expression-Print，打印匹配行" class="headerlink" title="grep：Global Regular Expression Print，打印匹配行"></a><code>grep</code>：Global Regular Expression Print，打印匹配行</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep [OPTION]... PATTERN [FILE]...</span><br></pre></td></tr></table></figure>

<p><code>grep</code>是一个很强大的程序，它可以按照<code>PATTERN</code>的形式匹配文件或标准输入中的指定模式并打印其所在的行。<code>PATTERN</code>可以是我们需要检索的文本，也可以是更加复杂通用的<em>正则表达式</em>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[meme@localhost Playground]$ <span class="built_in">cat</span> 22.txt | grep Everything</span><br><span class="line">Everything will be alright <span class="keyword">if</span> you keep me next to you.</span><br><span class="line">Everything will be alright <span class="keyword">if</span> you keep me next to you.</span><br><span class="line">Everything will be alright <span class="keyword">if</span> we just keep dancing like we<span class="string">&#x27;re</span></span><br></pre></td></tr></table></figure>

<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul>
<li><a target="_blank" rel="noopener" href="https://www.kancloud.cn/thinkphp/linux-command-line/39437">The Linux Command Line 中文版 第七章：重定向</a></li>
<li><a target="_blank" rel="noopener" href="https://www.kancloud.cn/thinkphp/linux-command-line/39451">The Linux Command Line 中文版 第二十章：正则表达式</a></li>
<li><a target="_blank" rel="noopener" href="https://www.kancloud.cn/thinkphp/linux-command-line/39452">The Linux Command Line 中文版 第二十一章：文本处理</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/oqqHuTu12345678/article/details/129282059">Shell高级——Here Document、Here String</a></li>
<li><a target="_blank" rel="noopener" href="https://www.zadmei.com/bzdc.html">Bash 中的 Cat EOF</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://zclzcl0223.github.io/2023/07/25/TextFileDataWrangling/" data-id="clzik0ld0008yv47kdezqcizs" data-title="Text, File and Data Wrangling" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Tool/" rel="tag">Tool</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-LinuxCommandLine" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/08/LinuxCommandLine/" class="article-date">
  <time class="dt-published" datetime="2023-07-08T14:21:55.000Z" itemprop="datePublished">2023-07-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Tool/">Tool</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/08/LinuxCommandLine/">Linux Command Line</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <span id="more"></span>

<p>总的参考：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.kancloud.cn/thinkphp/linux-command-line">The Linux Command Line 中文版</a></li>
</ul>
<p>目录：</p>
<ul>
<li><a href="/2023/07/25/TextFileDataWrangling/">Text, File and Data Wrangling：文本，文件与数据整理</a></li>
<li><a href="/2023/07/25/FileSearching/">File Searching：文件查找</a></li>
<li><a href="/2023/07/25/PackageProcessing/">Package Processing：软件包处理</a></li>
<li><a href="/2023/07/25/NetworkRemoteInteraction/">Network and Remote Interaction：网络系统与远程交互</a></li>
<li><a href="/2023/07/25/ProcessManagement/">Process Management：进程管理</a></li>
<li><a href="/2023/07/25/SystemSecurityPermission/">System Security and Permissions：系统安全与权限</a></li>
<li><a href="/2023/07/25/ProgramCompilation/">Program Compilation：程序编译</a></li>
<li><a href="/2023/08/03/WildcardsPatternMatching/">Wildcards and Pattern Matching：通配符</a></li>
<li><a href="/2023/08/04/RegularExpressions/">Regular Expressions：正则表达式</a></li>
<li><a href="/2023/09/02/BashScript/">Bash Script：Bash脚本</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://zclzcl0223.github.io/2023/07/08/LinuxCommandLine/" data-id="clzik0lci004hv47k4aap5ir2" data-title="Linux Command Line" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Tool/" rel="tag">Tool</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-PaperReading" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/06/07/PaperReading/" class="article-date">
  <time class="dt-published" datetime="2023-06-07T14:18:52.000Z" itemprop="datePublished">2023-06-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Paper/">Paper</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/06/07/PaperReading/">找论文，读论文，用论文，写论文</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <span id="more"></span>

<h1 id="找论文"><a href="#找论文" class="headerlink" title="找论文"></a>找论文</h1><p>Source of papers</p>
<ul>
<li>Twitter: 关注学者的账号;</li>
<li>ML Subreddit (machine learning)</li>
<li>NIPS&#x2F;ICML&#x2F;ICLR (machine learning) [顶会]</li>
<li>Arxiv: 会有只有摘要的未完成文章, 占坑专用;</li>
<li>dblp: 几乎是计算机领域最全的数据库;</li>
<li>IEEE: 也较全。</li>
</ul>
<p>Reading list</p>
<ul>
<li>Get a set of papers(5 is enough);</li>
<li>Skim all of them.If one paper is nonsense, just forget it.Find the most valuable paper,try to understand it and add some of its references to the reading list;</li>
<li>Jump to the other papers of reading list.</li>
</ul>
<h1 id="读论文"><a href="#读论文" class="headerlink" title="读论文"></a>读论文</h1><p>How to read a paper</p>
<ul>
<li><p>The first time: Read the title&#x2F;abstract&#x2F;figures [ie.the graph or table];</p>
</li>
<li><p>The second time: Read intro&#x2F;conclu&#x2F;figures&#x2F;skim the other parts. Actually, to persuade reviewer to accept your paper, the abstract&#x2F;intro&#x2F;conclu are always the most  clear part.</p>
</li>
<li><p>The third time: Read but skim the maths;</p>
</li>
<li><p>The forth time: Read the whole paper but jump over the nonsense part. Which part is nonsense?Parts that are not quite relative to the main topic.</p>
</li>
<li><p>标题+作者</p>
<blockquote>
<p>*表同等贡献</p>
</blockquote>
</li>
<li><p>摘要</p>
<blockquote>
<p>代码的链接一般放摘要的最后一句话</p>
</blockquote>
</li>
<li><p>结论</p>
</li>
<li><p>导言</p>
<blockquote>
<p>摘要的扩充： 一般介绍已有的工作和本文的工作</p>
</blockquote>
</li>
<li><p>相关工作</p>
</li>
</ul>
<blockquote>
<p>本工作运用到的已有工作： 联系、区别</p>
</blockquote>
<ul>
<li><p>模型</p>
<blockquote>
<p>重要章节</p>
</blockquote>
</li>
<li><p>实验</p>
</li>
</ul>
<blockquote>
</blockquote>
<ul>
<li><p>评论</p>
<blockquote>
<p>文章要讲好故事?</p>
</blockquote>
</li>
</ul>
<h1 id="用论文"><a href="#用论文" class="headerlink" title="用论文"></a>用论文</h1><p>用论文, 即理解论文的数学公式和代码.</p>
<p>How to deal with maths and code</p>
<ul>
<li>Read&#x2F;download it, run it and try to reproduce it</li>
</ul>
<p>What should I get after reading the whole paper?</p>
<ul>
<li>What did the authors try to accomplish?</li>
<li>What were the key element of the approach?</li>
<li>What can I use?</li>
<li>What other references do I want(not) to follow?</li>
</ul>
<p>Frequency</p>
<ul>
<li>Reading two or three papers a week is enough;</li>
</ul>
<h1 id="写论文"><a href="#写论文" class="headerlink" title="写论文"></a>写论文</h1><h2 id="深度学习代码"><a href="#深度学习代码" class="headerlink" title="深度学习代码"></a>深度学习代码</h2><p>深度学习的代码几乎都由3个小组件组成：<code>dataset</code>、<code>model</code>和<code>train</code>。</p>
<h3 id="dataset"><a href="#dataset" class="headerlink" title="dataset"></a>dataset</h3><p><code>dataset</code>，即对训练和测试用的数据集进行<strong>预处理</strong>，它构建了整个AI模型的输入和输出格式。在这一组件中，我们要对数据集的内容、架构有足够的了解，并对数据的<strong>存储方式</strong>和<strong>存储位置</strong>（如是否要分布式等）。<code>dataset</code>组件作为一个主要处理数据的组件，其写作与<code>train</code>组件息息相关。如，基于一次能存入gpu的数据的大小，我们要选择合适的<strong>batchsize</strong>，而batchsize直接影响了<strong>learning rate</strong>的大小。因此，<code>dataset</code>组件和<code>model</code>组件都应该放在<code>train</code>组件之前完成。</p>
<blockquote>
<p>当论文的主要工作为数据处理时，<code>dataset</code>组件更要好好写。</p>
</blockquote>
<h3 id="model"><a href="#model" class="headerlink" title="model"></a>model</h3><p><code>model</code>，是整个深度学习代码的骨架，也决定的AI模型的输入和输出格式。由于当前很多数据集的输入和输入模式都是有现成的框架可以参考的，如GNN有PyG、CV有ImageNet等，所以更加推荐的是先写好<code>dataset</code>，在写<code>model</code>，并对<code>model</code>进行测试。</p>
<h3 id="train"><a href="#train" class="headerlink" title="train"></a>train</h3><p><code>train</code>，构建了模型的训练策略和评估方法。无论论文的创新点在何处，<code>train</code>组件都是最重要和最复杂的组件。除网络架构以外的<strong>超参数</strong>，基本都要在<code>train</code>模块中调节。此外，代码作为论文的重要部分，它为论文提供的不仅仅是想法的实现，还有润色论文的<strong>可视化信息</strong>，如数据、表格、曲线等，而这些都是<code>train</code>组件的一部分。</p>
<blockquote>
<p>有时，当训练一个模型要很长时间时，我们可以将每次的模型参数都存储下来，而这也是在<code>train</code>模块进行的。</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://zclzcl0223.github.io/2023/06/07/PaperReading/" data-id="clzik0lcu007ev47k4cko9d0f" data-title="找论文，读论文，用论文，写论文" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Paper/" rel="tag">Paper</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-PyTorch" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/04/28/PyTorch/" class="article-date">
  <time class="dt-published" datetime="2023-04-28T14:29:21.000Z" itemprop="datePublished">2023-04-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Tool/">Tool</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/04/28/PyTorch/">PyTorch</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <span id="more"></span>

<h1 id="Installation-and-import"><a href="#Installation-and-import" class="headerlink" title="Installation and import"></a>Installation and import</h1><p>Since PyTorch is based on the Torch library, the name of package is actually called <em>torch</em>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Installation</span></span><br><span class="line">pip install torch</span><br><span class="line">or</span><br><span class="line">conda install torch</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># import</span></span><br><span class="line"><span class="keyword">import</span> torch</span><br></pre></td></tr></table></figure>

<h1 id="Basic-concept"><a href="#Basic-concept" class="headerlink" title="Basic concept"></a>Basic concept</h1><p>The basic data type in PyTorch is also tensor which is almost the same as the tensor in TensorFlow. PyTorch provides two high-level features:</p>
<ul>
<li>Tensor computing with strong acceleration via GPUs (NumPy only runs on CPUs);</li>
<li>Deep neural networks built on tape-based automatic differentiation system.</li>
</ul>
<p>Both features have much in common with TensorFlow. However, compared to TensorFlow, the api provided by PyTorch are more closer to NumPy.</p>
<h1 id="Data-manipulation"><a href="#Data-manipulation" class="headerlink" title="Data manipulation"></a>Data manipulation</h1><p>To create a tensor, the operations we used are almost the same as those in NumPy:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line">x = torch.arange(<span class="number">12.</span>) <span class="comment"># float32</span></span><br><span class="line">x = torch.arange(<span class="number">12</span>) <span class="comment"># int64</span></span><br><span class="line">x = torch.zeros((<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>))</span><br><span class="line">x = torch.ones((<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>))</span><br><span class="line">x = torch.randn(<span class="number">3</span>, <span class="number">4</span>) <span class="comment"># random elements drawn from a standard normal distribution</span></span><br><span class="line">x = torch.tensor([[<span class="number">1</span>, <span class="number">2</span>], [<span class="number">2</span>, <span class="number">3</span>]])</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Unless otherwise specified, new tensors are stored in main memory and designated for CPU-based computation. See more indexing, slicing, operations and broadcasting in <a href="/2023/04/22/NumPy/">NumPy</a>.</p>
</blockquote>
<p>Though most operations are similar, there are still some differences. We use <code>torch.cat</code> to concatenate multiple tensors together:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">X = torch.arange(<span class="number">12</span>, dtype=torch.float32).reshape(-<span class="number">1</span>, <span class="number">4</span>)</span><br><span class="line">Y = torch.tensor([[<span class="number">2.0</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">3</span>], [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>], [<span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>]])</span><br><span class="line">torch.cat((X, Y), dim=<span class="number">0</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">We get:</span></span><br><span class="line"><span class="string">tensor([[ 0.,  1.,  2.,  3.],</span></span><br><span class="line"><span class="string">        [ 4.,  5.,  6.,  7.],</span></span><br><span class="line"><span class="string">        [ 8.,  9., 10., 11.],</span></span><br><span class="line"><span class="string">        [ 2.,  1.,  4.,  3.],</span></span><br><span class="line"><span class="string">        [ 1.,  2.,  3.,  4.],</span></span><br><span class="line"><span class="string">        [ 4.,  3.,  2.,  1.]])</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>In addition to <code>.reshape</code>, we can also use <code>.view</code> to get object of different shapes. There are some differences between the two operations. <code>.view</code> returns a view of the original tensor while <code>.shape</code> may return a copy of the original tensor. <code>.shape</code> only returns the view when the inputs are contiguous in memory.</p>
<h2 id="Saving-memory"><a href="#Saving-memory" class="headerlink" title="Saving memory"></a>Saving memory</h2><p><code>X = X +Y</code> will create a new object and allocate memory while <code>X[:] = X + Y</code> or <code>X += Y</code> will perform in-place operation.</p>
<h2 id="Conversion-to-other-python-objects"><a href="#Conversion-to-other-python-objects" class="headerlink" title="Conversion to other python objects"></a>Conversion to other python objects</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">A = X.numpy() <span class="comment"># torch.Tensor-&gt;numpy.ndarray</span></span><br><span class="line">B = torch.from_numpy(A) <span class="comment"># numpy.ndarray-&gt;torch.Tensor</span></span><br><span class="line">b = torch.tensor([<span class="number">2.2</span>]).item() <span class="comment"># size-1 tensor-&gt;python scalar</span></span><br></pre></td></tr></table></figure>

<h1 id="Linear-algebra-function"><a href="#Linear-algebra-function" class="headerlink" title="Linear algebra function"></a>Linear algebra function</h1><ul>
<li><code>A.T</code> shares memory with <code>A</code>;</li>
<li><code>A.clone()</code> returns a new object with the same elements of <code>A</code>;</li>
<li><code>A.mean([axes])</code> and <code>A.sum([axes])</code> return the mean or sum of [axes] in <code>A</code>. In general, [axes] will missing from the shape of the output, but we can add <code>keepdims=True</code> which will make the shape of [axes] 1, to remain [axes];</li>
<li><code>A.cumsum([axes])</code> calculate the cumulative sum of elements of <code>A</code> along some axes;</li>
<li><code>torch.dot(), torch.mv(), torch.mm()</code> (<code>A @ B</code> is also legal) calculate v-v products, m-v products and m-m products respectively;</li>
</ul>
<blockquote>
<p><code>A*B</code> or $A\odot B$ is called <strong>Hadamard product</strong>.</p>
</blockquote>
<h2 id="Norms"><a href="#Norms" class="headerlink" title="Norms"></a>Norms</h2><p>Norms ($||x||$) are often used to measure the length or size of each vector in a vector space (or matrix). They are scalars that satisfy:</p>
<ul>
<li>Non-negativity;</li>
<li>Homogeneity;</li>
<li>Triangle inequality</li>
</ul>
<p>For vectors, $\ell{_2}$ norms measure the (Eucilidean) length of vectors:</p>
<p>$$\vert |x|\vert_2&#x3D;\sqrt{\sum\limits_{i&#x3D;1}^{n}x_i^2}$$</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">torch.norm(x)</span><br></pre></td></tr></table></figure>
<p>$\ell{_1}$ norms are called Manhattan distance:</p>
<p>$$\vert |x|\vert_1&#x3D;\sqrt{\sum\limits_{i&#x3D;1}^{n}|x|}$$</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">torch.<span class="built_in">abs</span>(x).<span class="built_in">sum</span>()</span><br></pre></td></tr></table></figure>
<p>For matrices, we often use <strong>the Frobenius norm</strong>, which is the same as the $\ell_2$ norm:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">torch.norm(X)</span><br></pre></td></tr></table></figure>

<h1 id="Autograd"><a href="#Autograd" class="headerlink" title="Autograd"></a>Autograd</h1><p>See <a href="/2023/04/28/DiveIntoDeepLearningIntroduction/#Derivative-of-matrix
">Matrix derivative</a> to know more about matrix derivative. </p>
<p>Unlike TensorFlow, PyTorch use implicit construction to produce a computation graph, which allows us to simply use its api and don&#39;t have to declare the computation graph explicitly like <a href="/2023/04/12/Tensorflow/#Adam-algorithm">Autograd in Tensorflow</a>. Whenever we want to compute the derivative of a certain argument, we only need 4 steps in PyTorch:</p>
<ol>
<li>Attach gradients to those variables with respect to which we desire derivatives:<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Create independent variable and the space to store derivatives</span></span><br><span class="line">x = torch.arange(<span class="number">4.0</span>, requires_grad=<span class="literal">True</span>) <span class="comment"># or x.requires_grad_(True)</span></span><br></pre></td></tr></table></figure></li>
<li>Record the computation of the target value (dependent variable):<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">y = f(a) <span class="comment"># f is the function we define</span></span><br></pre></td></tr></table></figure></li>
<li>Execute the back propagation function:<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">y.backward()</span><br></pre></td></tr></table></figure></li>
<li>Access the resulting gradient:<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(x.grad)</span><br></pre></td></tr></table></figure></li>
</ol>
<p>The steps above only work when the dependent variable is a scalar. For non-scalar variables, we sometimes turn them to scalar variables by summing all elements together, like <code>y.sum().backward()</code>. This works because we add the gradients of a specific model parameter together finally. More commonly, we will use a certain row vector $v^T$ to turn $\vec{y}$ to a scalar:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># this is the same as: y.sum().backward(), because torch.dot(torch.ones(len(y)), y) = y.sum()</span></span><br><span class="line">y.backward(gradient=torch.ones(<span class="built_in">len</span>(y)))</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Since neural networks are always computed batch by batch, the result of <code>x.grad</code> will be accumulated. To reset the gradient buffer, we can call <code>x.grad.zero()</code>.</p>
</blockquote>
<h2 id="Detaching-computation"><a href="#Detaching-computation" class="headerlink" title="Detaching computation"></a>Detaching computation</h2><p>If $z&#x3D;f(x,y)$ and $y&#x3D;g(x)$, but we only want to focus on the <strong>direct influence</strong> of $x$ on $z$, we can create a new variable that detaches the connection between $x$ and $y$:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">y = g(x)</span><br><span class="line">u = y.detach() <span class="comment"># remove y from the computation graph of z</span></span><br><span class="line">z = x * u <span class="comment"># u is no longer a function of x but y is still a function of x</span></span><br><span class="line"></span><br><span class="line">z.<span class="built_in">sum</span>().backward()</span><br><span class="line">x.grad == u <span class="comment"># the value is true</span></span><br></pre></td></tr></table></figure>

<h2 id="Updating-parameters"><a href="#Updating-parameters" class="headerlink" title="Updating parameters"></a>Updating parameters</h2><p>The Computation graph (tree) will be built implicitly (if <code>requires_grad=True</code>) whenever we operate the parameters that we want to optimize. Since the parameters are always in leaf nodes, we have to detach it from the graph, otherwise, the whole graph will go wrong.</p>
<blockquote>
<p>PyTorch implements a dynamic graph mechanism. Specifically, the computation graph is constructed during forward propagation, and is destroyed during back propagation. More specifically, the computation graph is destroyed when calling <code>backward()</code>, leaving only parameters in leaf nodes.</p>
</blockquote>
<p>The method <code>PyTorch</code> used is <code>with torch.no_grad():</code>, which makes <code>requires_grad=False</code> when entering and <code>requires_grad=True</code> when leaving:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># General usage</span></span><br><span class="line"><span class="keyword">with</span> torch.no_grad():</span><br><span class="line">  <span class="keyword">for</span> param <span class="keyword">in</span> params:</span><br><span class="line">      param -= lr * param.grad / batch_size</span><br><span class="line">      param.grad.zero_()</span><br></pre></td></tr></table></figure>

<h1 id="Net-constructing"><a href="#Net-constructing" class="headerlink" title="Net constructing"></a>Net constructing</h1><p>All layers, blocks or nets in PyTorch are subclasses of <code>nn.Module</code>. We can define our own blocks by inheriting <code>nn.Module</code> and overloading the <code>__init__</code> and <code>forward</code> functions.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> torch.nn <span class="keyword">import</span> functional <span class="keyword">as</span> F</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MLP</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()  <span class="comment"># we must call the __init__ function of Module so that we can inherit its parameters</span></span><br><span class="line">        self.hidden = nn.Linear(<span class="number">20</span>, <span class="number">256</span>)  <span class="comment"># a hidden layer</span></span><br><span class="line">        self.out = nn.Linear(<span class="number">256</span>, <span class="number">10</span>)  <span class="comment"># output layer</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># forward propagation: get X and produce output</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, X</span>):</span><br><span class="line">        <span class="comment"># F defines some basic functions</span></span><br><span class="line">        <span class="keyword">return</span> self.out(F.relu(self.hidden(X)))</span><br><span class="line">net = MLP()</span><br><span class="line">net(X)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>In general, we just need to define the structure of our blocks in <code>__init__</code> and compute the output in <code>forward</code>. <code>forward</code> points to <code>__call__</code>, so <code>net(X)</code> is euqal to <code>net.forward(X)</code>.</p>
</blockquote>
<h2 id="Sequential"><a href="#Sequential" class="headerlink" title="Sequential"></a>Sequential</h2><p><code>nn.Sequential</code> is the built-in subclass of <code>nn.Module</code>. Its working principle is very simple, which just simply connects different blocks. We can define it by ourselves:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MySequential</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, *args</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        <span class="keyword">for</span> block <span class="keyword">in</span> args:</span><br><span class="line">            self._modules[block] = block</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, X</span>):</span><br><span class="line">        <span class="keyword">for</span> block <span class="keyword">in</span> self._modules.values():</span><br><span class="line">            X = block(X)</span><br><span class="line">        <span class="keyword">return</span> X</span><br><span class="line"></span><br><span class="line">net = MySequential(nn.Linear(<span class="number">20</span>, <span class="number">256</span>), nn.ReLU(), nn.Linear(<span class="number">256</span>, <span class="number">10</span>))</span><br><span class="line">net(X)</span><br></pre></td></tr></table></figure>
<p><code>MySequential</code> will compute in the order of <code>nn.Linear</code>, <code>nn.ReLU</code> and <code>nn.Linear</code>.</p>
<blockquote>
<p><code>._modules</code> is an <code>OrderedDict</code> defined in <code>nn.Module</code>. It will store our blocks in order. All the arguments of <code>Sequential</code> should be the subclass of <code>nn.Module</code>.</p>
<p>In PyTorch, the activation is also a layer though it doesn&#39;t have any model parameters.</p>
</blockquote>
<h1 id="Parameter-management"><a href="#Parameter-management" class="headerlink" title="Parameter management"></a>Parameter management</h1><p>The type of model parameters in PyTorch is <code>nn.Parameter</code> which is a compound object containing values (<code>Tensor</code>), gradients (<code>grad</code>) and extra information. <code>grad</code> works when we call <code>.backward</code> and <code>requires_grad=True</code>.</p>
<h2 id="Parameter-visiting"><a href="#Parameter-visiting" class="headerlink" title="Parameter visiting"></a>Parameter visiting</h2><p>For blocks that define model parameters, we can use <code>.state_dict()</code> which returns a dictionary to visit the model parameters:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">net = nn.Sequential(nn.Linear(<span class="number">4</span>, <span class="number">8</span>), nn.ReLU(), nn.Linear(<span class="number">8</span>, <span class="number">1</span>))</span><br><span class="line"><span class="built_in">print</span>(net[<span class="number">2</span>].state_dict())</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">OrderedDict([(&#x27;weight&#x27;, tensor([[ 0.3016, -0.1901, -0.1991, -0.1220,  0.1121, -0.1424, -0.3060,  0.3400]])), (&#x27;bias&#x27;, tensor([-0.0291]))])</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(net[<span class="number">2</span>].bias))</span><br><span class="line"><span class="built_in">print</span>(net[<span class="number">2</span>].bias)</span><br><span class="line"><span class="built_in">print</span>(net[<span class="number">2</span>].bias.data)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&lt;class &#x27;torch.nn.parameter.Parameter&#x27;&gt;</span></span><br><span class="line"><span class="string">Parameter containing:</span></span><br><span class="line"><span class="string">tensor([-0.0291], requires_grad=True)</span></span><br><span class="line"><span class="string">tensor([-0.0291])</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>Sequential</code> allows use to visit each block like a <code>list</code>. If we just <code>print(net)</code>, python will output the structure of <code>net</code>.</p>
</blockquote>
<h2 id="Parameter-initialization"><a href="#Parameter-initialization" class="headerlink" title="Parameter initialization"></a>Parameter initialization</h2><p>We can define our own function to initialize the model parameters:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">init_normal</span>(<span class="params">m</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">type</span>(m) == nn.Linear:</span><br><span class="line">        nn.init.normal_(m.weight, mean=<span class="number">0</span>, std=<span class="number">0.01</span>)</span><br><span class="line">        nn.init.zeros_(m.bias)</span><br><span class="line">net.apply(init_normal)</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>m</code> is the subclass of <code>nn.Module</code>. <code>net.apply</code> asks PyTorch to call <code>init_normal</code> for each block. Only the block with model parameters will initialize its parameters. (So far, only the built-in <code>nn.Linear</code> has defined model parameters).</p>
</blockquote>
<p>Since each block is the subclass of <code>nn.Module</code>, we could also initialize each block respectively:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net[<span class="number">0</span>].apply(init_normal)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Direct initialization is also possible, like:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">my_init</span>(<span class="params">m</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">type</span>(m) == nn.Linear:</span><br><span class="line">        nn.init.uniform_(m.weight, -<span class="number">10</span>, <span class="number">10</span>)</span><br><span class="line">        m.weight.data *= m.weight.data.<span class="built_in">abs</span>() &gt;= <span class="number">5</span></span><br></pre></td></tr></table></figure>
<p>We must not initialize all <code>weight</code> using the same value. If we do so, all the neurons in a layer are computing the same thing, that is, they will output the same value and their gradients will also be the same.</p>
</blockquote>
<h2 id="Shared-layer"><a href="#Shared-layer" class="headerlink" title="Shared layer"></a>Shared layer</h2><p>Since instances of custom classes are mutable objects in python, we can make two layers share their parameters by passing the same object to PyTorch:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">shared = nn.Linear(<span class="number">8</span>, <span class="number">8</span>)</span><br><span class="line">net = nn.Sequential(nn.Linear(<span class="number">4</span>, <span class="number">8</span>), nn.ReLU(),</span><br><span class="line">                    shared, nn.ReLU(),</span><br><span class="line">                    shared, nn.ReLU(),</span><br><span class="line">                    nn.Linear(<span class="number">8</span>, <span class="number">1</span>))</span><br></pre></td></tr></table></figure>

<h2 id="Block-with-parameters"><a href="#Block-with-parameters" class="headerlink" title="Block with parameters"></a>Block with parameters</h2><p>We could define parameters for our own blocks. Since <code>backward</code> will work for all <code>Tensor</code>, we don&#39;t have to deal with <code>backward</code>. We just need to define our parameters and set <code>requires_grad=True</code>.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyLinear</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, in_units, units</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.weight = nn.Parameter(torch.randn(in_units, units))</span><br><span class="line">        self.bias = nn.Parameter(torch.randn(units,))</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, X</span>):</span><br><span class="line">        linear = torch.matmul(X, self.weight.data) + self.bias.data</span><br><span class="line">        <span class="keyword">return</span> F.relu(linear)</span><br></pre></td></tr></table></figure>

<h1 id="Saving-amp-loading-parameters"><a href="#Saving-amp-loading-parameters" class="headerlink" title="Saving &amp; loading parameters"></a>Saving &amp; loading parameters</h1><p>We can save a tensor, a tensor list or a dictionary using <code>torch.save</code> and load them using <code>torch.load</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">x = torch.arange(<span class="number">4</span>)</span><br><span class="line">y = torch.arange(<span class="number">5</span>)</span><br><span class="line">z = &#123;<span class="string">&#x27;x&#x27;</span>: x, <span class="string">&#x27;y&#x27;</span>: y&#125;</span><br><span class="line">torch.save(x, <span class="string">&#x27;x-file&#x27;</span>)</span><br><span class="line">torch.save([x, y], <span class="string">&#x27;xy-file&#x27;</span>)</span><br><span class="line">torch.save(z, <span class="string">&#x27;z-dict&#x27;</span>)</span><br><span class="line"></span><br><span class="line">x1 = torch.load(<span class="string">&#x27;x-file&#x27;</span>)</span><br><span class="line">xx, yy = torch.load(<span class="string">&#x27;xy-file&#x27;</span>)</span><br><span class="line">zz = torch.load(<span class="string">&#x27;z-dict&#x27;</span>)</span><br><span class="line"></span><br><span class="line">x1 == x, xx == x, yy == y, zz[<span class="string">&#x27;x&#x27;</span>] == x, zz[<span class="string">&#x27;y&#x27;</span>] == y</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">(tensor([True, True, True, True]),</span></span><br><span class="line"><span class="string"> tensor([True, True, True, True]),</span></span><br><span class="line"><span class="string"> tensor([True, True, True, True, True]),</span></span><br><span class="line"><span class="string"> tensor([True, True, True, True]),</span></span><br><span class="line"><span class="string"> tensor([True, True, True, True, True]))</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>For a model, PyTorch will save its parameters rather than the whole model:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MLP</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.hidden = nn.Linear(<span class="number">20</span>, <span class="number">256</span>)</span><br><span class="line">        self.output = nn.Linear(<span class="number">256</span>, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        <span class="keyword">return</span> self.output(F.relu(self.hidden(x)))</span><br><span class="line"></span><br><span class="line">net = MLP()</span><br><span class="line">torch.save(net.state_dict(), <span class="string">&#x27;mlp.params&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>When we need to load the model, we should rebuild the same structure and load the parameters:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">clone = MLP()</span><br><span class="line">clone.load_state_dict(torch.load(<span class="string">&#x27;mlp.params&#x27;</span>))</span><br></pre></td></tr></table></figure>

<h1 id="Training-in-GPUs"><a href="#Training-in-GPUs" class="headerlink" title="Training in GPUs"></a>Training in GPUs</h1><p>Tensors are created on CPU by default.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x = torch.tensor([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line">x.device</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">device(type=&#x27;cpu&#x27;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>To create a tensor in GPU, we must specify the GPU we use:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">X = torch.ones(<span class="number">2</span>, <span class="number">3</span>, device=torch.device(<span class="string">&#x27;cuda&#x27;</span>))</span><br><span class="line">X.device</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">device(type=&#x27;cuda&#x27;, index=0)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>cuda</code> means GPU in PyTorch. All Nvidia GPUs owned by the computer are organized into an array. <code>cuda</code> or <code>cuda:0</code> represent the first GPU and <code>cuda:1</code> represent the second GPU. We can use <code>!nvidia-smi</code> to get the information of Nvidia GPUs in our computer and <code>torch.cuda.device_count()</code> to get the number of Nvidia GPUs of our computer.</p>
</blockquote>
<p>If we want to operate different tensors together, we must make sure that they are stored in the same GPU, otherwise, PyTorch will throw an exception <strong>because moving data from CPU to GPU or from GPU to another GPU is time-consuming</strong>.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Y = torch.rand(<span class="number">2</span>, <span class="number">3</span>, device=torch.device(<span class="string">&#x27;cuda&#x27;</span>))</span><br><span class="line">Z = torch.rand(<span class="number">2</span>, <span class="number">3</span>)  <span class="comment"># create in CPU</span></span><br><span class="line">X = Z.cuda(<span class="number">0</span>)  <span class="comment"># create a new tensor in GPU 0</span></span><br><span class="line"><span class="built_in">print</span>(X)</span><br><span class="line"><span class="built_in">print</span>(Z)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">tensor([[0.3206, 0.4276, 0.8653],</span></span><br><span class="line"><span class="string">        [0.3276, 0.4867, 0.1320]], device=&#x27;cuda:0&#x27;)</span></span><br><span class="line"><span class="string">tensor([[0.3206, 0.4276, 0.8653],</span></span><br><span class="line"><span class="string">        [0.3276, 0.4867, 0.1320]])</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># now we can add Y and X</span></span><br><span class="line">X + Y</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">tensor([[0.8401, 0.6486, 1.8582],</span></span><br><span class="line"><span class="string">        [1.1932, 0.8063, 1.1152]], device=&#x27;cuda:0&#x27;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># if we add Y and Z</span></span><br><span class="line">Y + Z</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">RuntimeError: Expected all tensors to be on the same device, but found at least two devices, cuda:0 and cpu!</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="Neural-networks-in-GPU"><a href="#Neural-networks-in-GPU" class="headerlink" title="Neural networks in GPU"></a>Neural networks in GPU</h2><p>Similarly, we can put the parameters of neural networks in GPU:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">net = nn.Sequential(nn.Linear(<span class="number">3</span>, <span class="number">1</span>))</span><br><span class="line">net = net.to(device=torch.device(<span class="string">&#x27;cuda&#x27;</span>))</span><br><span class="line">net(X)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">tensor([[-0.1712],</span></span><br><span class="line"><span class="string">        [ 0.1713]], device=&#x27;cuda:0&#x27;, grad_fn=&lt;AddmmBackward0&gt;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>Both parameters and data should be stored in the same device. Inadvertently moving data from one device to another can significantly degrade performance, which is what we need to pay attention to. For example, report data to the user on the command line or log it in a NumPy ndarray, both of which will cause data movement from GPU to CPU.</p>
<blockquote>
<p>To enable training the model in GPUs, we should install CUDA and NVIDIA Driver in <a target="_blank" rel="noopener" href="https://developer.nvidia.com/cuda-downloads">CUDA Toolkit</a> and install the corresponding GPU version of pytorch in <a target="_blank" rel="noopener" href="https://pytorch.org/get-started/locally/">PyTorch</a>.</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://zclzcl0223.github.io/2023/04/28/PyTorch/" data-id="clzik0lct0078v47k6x64a1tr" data-title="PyTorch" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Deep-Learning/" rel="tag">Deep Learning</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Machine-Learning/" rel="tag">Machine Learning</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Tool/" rel="tag">Tool</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Tensorflow" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/04/12/Tensorflow/" class="article-date">
  <time class="dt-published" datetime="2023-04-12T14:00:29.000Z" itemprop="datePublished">2023-04-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Tool/">Tool</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/04/12/Tensorflow/">Tensorflow</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <span id="more"></span>

<h1 id="Basic-data-structure"><a href="#Basic-data-structure" class="headerlink" title="Basic data structure"></a>Basic data structure</h1><p>See <a href="/2023/04/10/NeuralNetwork/#Numpy-and-Tensorflow
">Numpy and Tensorflow</a>.</p>
<h1 id="Neural-networks"><a href="#Neural-networks" class="headerlink" title="Neural networks"></a>Neural networks</h1><h2 id="Normalize-data"><a href="#Normalize-data" class="headerlink" title="Normalize data"></a>Normalize data</h2><p>Fitting the weights (<code>w</code>, <code>b</code>) to the data will proceed more quickly if the data is normalized. In tensorflow, we can use <code>Normalization</code> to normalize data. It uses z-score. However, it is a preprocessing layer rather than an independent layer of model.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras.layers <span class="keyword">import</span> Normalization</span><br><span class="line">norm_l = Normalization(axis=-<span class="number">1</span>)</span><br><span class="line">norm_l.adapt(X) <span class="comment"># learns mean, variance</span></span><br><span class="line">Xn = norm_l(X)</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li><code>axis=-1</code> means that it will normalize the last dimension of <code>X</code>. For 2-D arrays, it will normalize the <strong>column</strong>. In this case, <code>axis=-1</code> is equal to <code>axis=1</code>.</li>
<li>After normalizing, the test set should also be normalized: <code>X_testn = norm_l(X_test)</code>.</li>
</ul>
</blockquote>
<h2 id="Create-the-model"><a href="#Create-the-model" class="headerlink" title="Create the model"></a>Create the model</h2><p>For a neural network like this:</p>
<p><img src="/2023/04/12/Tensorflow/1.png" alt="1"></p>
<center style="font-size:12px;font-weight:bold"> Fig. 1. Sample</center><br>

<p>we can create the neural network using tensorflow in Python:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> Sequential</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.layers <span class="keyword">import</span> Dense</span><br><span class="line"></span><br><span class="line"><span class="comment"># non-regularization</span></span><br><span class="line">model = Sequential([</span><br><span class="line">    <span class="comment"># We can use the following code to specify the shape of input layer</span></span><br><span class="line">    <span class="comment">## tf.keras.Input(shape=(x,))</span></span><br><span class="line">    Dense(units=<span class="number">25</span>, activation=<span class="string">&#x27;sigmoid&#x27;</span>),</span><br><span class="line">    Dense(units=<span class="number">15</span>, activation=<span class="string">&#x27;sigmoid&#x27;</span>),</span><br><span class="line">    Dense(units=<span class="number">1</span>, activation=<span class="string">&#x27;sigmoid&#x27;</span>)</span><br><span class="line">                   ])</span><br><span class="line"><span class="comment"># regularization</span></span><br><span class="line">model = Sequential([</span><br><span class="line">    Dense(units=<span class="number">25</span>, activation=<span class="string">&#x27;sigmoid&#x27;</span>, kernel_regularizer=L2(<span class="number">0.01</span>)),</span><br><span class="line">    Dense(units=<span class="number">15</span>, activation=<span class="string">&#x27;sigmoid&#x27;</span>, kernel_regularizer=L2(<span class="number">0.01</span>)),</span><br><span class="line">    Dense(units=<span class="number">1</span>, activation=<span class="string">&#x27;sigmoid&#x27;</span>, kernel_regularizer=L2(<span class="number">0.01</span>))</span><br><span class="line">                   ])  <span class="comment"># 0.01 is the value of lambda</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Keras is an open-source software library that provides a Python interface for neural networks. It is now a package under tensorflow,which acts as an interface.</p>
<ul>
<li><code>units</code> represents the number of neuron in this layerr.</li>
<li><code>activation</code> represents the <code>activation function</code> you choose for this layer.</li>
<li><code>Dense</code> is a kind of hidden layer that make use of all the inputs for each neuron.</li>
<li>We can also assign names to each layer using <code>name=&#39;xx&#39;</code>. For the first layer, using <code>input_dim=xx</code> is another way to specify the shape of input layer.</li>
<li>When specifying the shape of input layer, <code>model</code> will be instantiated. That is, parameters of all layers will be initialized.</li>
<li>Use <code>.summary</code> to get the structure of model. Use <code>.get_layer(&#39;layer_name&#39;)</code> to get the certain layer.</li>
</ul>
</blockquote>
<p>We can also create the neural network layer by layer:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">x = np.array([[<span class="number">10</span>, <span class="number">11</span>]])</span><br><span class="line">layer_1 = Dense(units=<span class="number">25</span>, activation=<span class="string">&#x27;sigmoid&#x27;</span>)</span><br><span class="line">layer_2 = Dense(units=<span class="number">15</span>, activation=<span class="string">&#x27;sigmoid&#x27;</span>)</span><br><span class="line">layer_3 = Dense(units=<span class="number">1</span>, activation=<span class="string">&#x27;sigmoid&#x27;</span>)</span><br><span class="line"></span><br><span class="line">a1 = layer_1(x)</span><br><span class="line">a2 = layer_2(a1)</span><br><span class="line">a3 = layer_3(a2)  <span class="comment"># the final output</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>For each layer, we can use <code>.get_weights()</code> to get its <code>w</code> and <code>b</code>. Feed some examples to instantiate them or use <code>.set_weights([w, b])</code> to initialize them.</p>
</blockquote>
<p>The first way is more convenient and universal, as it builds a neural network at once.</p>
<blockquote>
<p>Name of activation functions in keras:</p>
<ul>
<li>relu</li>
<li>sigmoid</li>
<li>linear</li>
<li>softmax</li>
<li>...</li>
</ul>
</blockquote>
<h2 id="Loss-and-cost-functions"><a href="#Loss-and-cost-functions" class="headerlink" title="Loss and cost functions"></a>Loss and cost functions</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> losses</span><br><span class="line"></span><br><span class="line"><span class="comment"># for binary classificaiton</span></span><br><span class="line">model.<span class="built_in">compile</span>(loss=losses.BinaryCrossentropy())</span><br><span class="line"><span class="comment"># for linear regression</span></span><br><span class="line">model.<span class="built_in">compile</span>(loss=losses.MeanSquaredError())</span><br><span class="line"><span class="comment"># for Adam algorithm</span></span><br><span class="line">model.<span class="built_in">compile</span>(optimizer=tf.keras.optimizers.Adam(learning_rate=<span class="number">1e-3</span>), loss=YourChoiceOfFunction)</span><br></pre></td></tr></table></figure>
<p>See <a href="/2023/04/10/NeuralNetwork/#Adam-algorithm">Adam algorithm</a> to know more about Adam.</p>
<p>At this step, the structure of the neural network has already been established.</p>
<blockquote>
<p>The name of some loss functions in <code>losses</code>:</p>
<ul>
<li>BinaryCrossentropy: Binary classification</li>
<li>MeanSquaredError: Linear regression</li>
<li>SparseCategoricalCrossentropy: Multiclass classification</li>
</ul>
</blockquote>
<p>If we regard the whole neural network as a generalized model, the model and cost function can be represent as:<br>$$<br>f(W,B)(\vec{x})<br>$$<br>$$<br>J(W,B)&#x3D;\frac{1}{m}\sum\limits_{i&#x3D;1}^{m}L(f(\vec{x}^{(i)},y^{(i)}))<br>$$</p>
<h2 id="Regularization"><a href="#Regularization" class="headerlink" title="Regularization"></a>Regularization</h2><p>When regularization, we just need to add:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kernel_regularizer=tf.keras.regularizers.l2(<span class="number">0.1</span>) <span class="comment"># 0.1 is the value of lambda</span></span><br></pre></td></tr></table></figure>
<p>to the layer that we want to regularize.</p>
<h2 id="Gradient-descent"><a href="#Gradient-descent" class="headerlink" title="Gradient descent"></a>Gradient descent</h2><p>This is the final step to train a neural network. In this step, we use gradient descent to determine $W$ and $B$.</p>
<blockquote>
<p>Capital means matrix</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model.fit(X, y, epochs=<span class="number">100</span>)</span><br></pre></td></tr></table></figure>
<p>The algorithm used in <code>fit</code> is called <strong>Backpropagation</strong>. <code>X,y</code> is our training set and <code>epochs</code> represents the number of iterations.</p>
<p>After finishing the training of neural network, we can use <code>model.predict()</code> or <code>model()</code> to predict or infer.</p>
<blockquote>
<p>The type of <code>model.predict()</code> is <code>tf</code> while the type of <code>model()</code> is <code>np</code>.</p>
</blockquote>
<h2 id="Optimization-for-softmax"><a href="#Optimization-for-softmax" class="headerlink" title="Optimization for softmax"></a>Optimization for softmax</h2><p>In multiclass classfication, the following code will work, but the value is not very accurate. See <a href="/2023/04/10/NeuralNetwork/#Softmax-regression">Softmax regression</a> to know more about multiclass classification and softmax.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> Sequential</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.layers <span class="keyword">import</span> Dense</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.losses <span class="keyword">import</span> SparseCategoricalCrossentropy</span><br><span class="line"></span><br><span class="line">model = Sequential([</span><br><span class="line">    Dense(units=<span class="number">25</span>, activation=<span class="string">&#x27;relu&#x27;</span>)</span><br><span class="line">    Dense(units=<span class="number">15</span>, activation=<span class="string">&#x27;relu&#x27;</span>)</span><br><span class="line">    Dense(units=<span class="number">10</span>, activation=<span class="string">&#x27;softmax&#x27;</span>)</span><br><span class="line">                   ])</span><br><span class="line">model.<span class="built_in">compile</span>(loss=SparseCategoricalCrossentropy())</span><br><span class="line">model.fit(X, y, epochs=<span class="number">100</span>)</span><br></pre></td></tr></table></figure>
<p>Due to the limitations in precision when using binary to represent decimals, the more intermediate values we use, the greater the loss of precision we get. Before we calculate $loss$, we must get the value of $a$. $a$ is a intermediate value, so it is advisable for us to replace $a$ in $loss$ with its original formula. That is:<br>$$a_i&#x3D;g(z)&#x3D;\frac{e^{z_i}}{e^{z_1}+...+e^{z_i}}$$<br>$$loss&#x3D;-\log{a_1}, y&#x3D;1...$$<br>$$\downarrow$$<br>$$loss&#x3D;-\log\frac{e^{z_i}}{e^{z_1}+...+e^{z_i}},y&#x3D;1...$$<br>To realize this, we just need to set the activation function of output layer to <code>linear</code> and set <code>from_logits</code> to <code>True</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">model = Sequential([</span><br><span class="line">    Dense(units=<span class="number">25</span>, activation=<span class="string">&#x27;relu&#x27;</span>)</span><br><span class="line">    Dense(units=<span class="number">15</span>, activation=<span class="string">&#x27;relu&#x27;</span>)</span><br><span class="line">    Dense(units=<span class="number">10</span>, activation=<span class="string">&#x27;linear&#x27;</span>)</span><br><span class="line">                   ])</span><br><span class="line">model.<span class="built_in">compile</span>(loss=SparseCategoricalCrossentropy(from_logits=<span class="literal">True</span>))</span><br></pre></td></tr></table></figure>
<p>The principle of this code is that $g(z)$ is just $z$, and tensorflow will replace $a$ with its original formula in loss function. <code>from_logits</code> actuallly means use $z$ rather than $a$. This gives tensorflow more flexibility to rearrange the terms to get more accurate values.</p>
<blockquote>
<p>In this case, the output of our neural network is actually a vector of $z$. Therefore, we have to add </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">logit = model(X)</span><br><span class="line">f_x = tf.nn.softmax(logit)</span><br></pre></td></tr></table></figure>
<p>to get the real values. However, to get the label, we just need to use <code>np.argmax(y_pred, axis=0)</code>.</p>
</blockquote>
<p>The same optimization can also be applied to other neural networks, like binary classification.</p>
<h1 id="Regression-model"><a href="#Regression-model" class="headerlink" title="Regression model"></a>Regression model</h1><p>For regression models, Auto Diff (Auto Grad) of Tensorflow can help us get partial derivatives automatically.</p>
<h2 id="Gradient-descent-1"><a href="#Gradient-descent-1" class="headerlink" title="Gradient descent"></a>Gradient descent</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="comment"># for J = (wx-1)^2</span></span><br><span class="line"></span><br><span class="line">w = tf.Variable(<span class="number">3.0</span>) <span class="comment"># The parameters we want to optimize, they can also be vector</span></span><br><span class="line">x = <span class="number">1.0</span> <span class="comment"># Features of trainng set</span></span><br><span class="line">y = <span class="number">1.0</span> <span class="comment"># Target value of training set</span></span><br><span class="line">alpha = <span class="number">0.01</span> <span class="comment"># Learning rate</span></span><br><span class="line"></span><br><span class="line">iterations = <span class="number">30</span> <span class="comment"># Number of iteration</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> <span class="built_in">iter</span> <span class="keyword">in</span> <span class="built_in">range</span>(iterations):</span><br><span class="line">    <span class="keyword">with</span> tf.GradientTape() <span class="keyword">as</span> tape: <span class="comment"># Record the steps</span></span><br><span class="line">        fwb = w * x <span class="comment"># Model</span></span><br><span class="line">        costJ = (fwb - y)**<span class="number">2</span> <span class="comment"># Cost function which should be implemented by ourselves</span></span><br><span class="line">    [dJdw] = tape.gradient(costJ, [w]) <span class="comment"># Calculate derivatives</span></span><br><span class="line"></span><br><span class="line">    w.assign_add(-alpha * dJdw) <span class="comment"># Update w</span></span><br></pre></td></tr></table></figure>

<h2 id="Adam-algorithm"><a href="#Adam-algorithm" class="headerlink" title="Adam algorithm"></a>Adam algorithm</h2><p>The example used here is about collaborative filtering. See <a href="/2023/04/17/RecommenderSystem/#Collaborative-filtering">Collaborative filtering</a> to know more about it.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow <span class="keyword">import</span> keras</span><br><span class="line"></span><br><span class="line"><span class="comment"># Instantiate an adam optimizer</span></span><br><span class="line">W = tf.Variable(tf.random.normal((num_users,  num_features),dtype=tf.float64),  name=<span class="string">&#x27;W&#x27;</span>)</span><br><span class="line">X = tf.Variable(tf.random.normal((num_items, num_features),dtype=tf.float64),  name=<span class="string">&#x27;X&#x27;</span>)</span><br><span class="line">b = tf.Variable(tf.random.normal((<span class="number">1</span>,          num_users),   dtype=tf.float64),  name=<span class="string">&#x27;b&#x27;</span>)</span><br><span class="line"></span><br><span class="line">optimizer = keras.optimizers.Adam(learning_rate=<span class="number">1e-1</span>)</span><br><span class="line"></span><br><span class="line">iterations = <span class="number">200</span></span><br><span class="line"><span class="keyword">for</span> <span class="built_in">iter</span> <span class="keyword">in</span> <span class="built_in">range</span>(iterations):</span><br><span class="line">    <span class="keyword">with</span> tf.GradientTape() <span class="keyword">as</span> tape:</span><br><span class="line">        <span class="comment"># features, w, b, mean normalization, R (which item have a rating), number of users, number of items, lambda</span></span><br><span class="line">        coast_value = cofiCostFuncV(X, W, b, Ynorm, R, num_users, num_items, <span class="keyword">lambda</span>) <span class="comment"># Compute cost which should be implemented by ourselves</span></span><br><span class="line">    grads = tape.gradient(cost_value, [X, W, b]) <span class="comment"># Calculate derivatives</span></span><br><span class="line">    optimizer.apply_gradients(<span class="built_in">zip</span>(grads, [X, W, b])) <span class="comment"># Update X, W, b</span></span><br></pre></td></tr></table></figure>

<h1 id="More-information"><a href="#More-information" class="headerlink" title="More information"></a>More information</h1><ul>
<li><a target="_blank" rel="noopener" href="https://www.tensorflow.org/api_docs/python/tf">Tensorflow API</a></li>
<li><a target="_blank" rel="noopener" href="https://www.tensorflow.org/guide/function">Better performance with tf.function</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://zclzcl0223.github.io/2023/04/12/Tensorflow/" data-id="clzik0lcz008rv47k2cjuepjq" data-title="Tensorflow" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Deep-Learning/" rel="tag">Deep Learning</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Machine-Learning/" rel="tag">Machine Learning</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Tool/" rel="tag">Tool</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/7/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="page-number" href="/page/7/">7</a><span class="page-number current">8</span><a class="page-number" href="/page/9/">9</a><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/9/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Advanced-Model/">Advanced Model</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CS7313-Computational-Complexity/">CS7313: Computational Complexity</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Configuration/">Configuration</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Dive-Into-Deep-Learning/">Dive Into Deep Learning</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/GNN/">GNN</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kernel-Method/">Kernel Method</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/MATH6005-Matrix-Theory/">MATH6005: Matrix Theory</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Machine-Learning-by-AndrewNg/">Machine Learning by AndrewNg</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Math/">Math</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Paper/">Paper</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Programming-Language/">Programming Language</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tool/">Tool</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Attention-Mechanism/" rel="tag">Attention Mechanism</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CNN/" rel="tag">CNN</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Configuration/" rel="tag">Configuration</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Data-Analysis/" rel="tag">Data Analysis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Dataset-Distillation/" rel="tag">Dataset Distillation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Decision-Trees/" rel="tag">Decision Trees</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Deep-Learning/" rel="tag">Deep Learning</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GCN/" rel="tag">GCN</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GNN/" rel="tag">GNN</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Generative-AI/" rel="tag">Generative AI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/" rel="tag">Hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Lab/" rel="tag">Lab</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Machine-Learning/" rel="tag">Machine Learning</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Markup-Language/" rel="tag">Markup Language</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Math/" rel="tag">Math</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Paper/" rel="tag">Paper</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RNN/" rel="tag">RNN</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Recommender-System/" rel="tag">Recommender System</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Reinforcement-Learning/" rel="tag">Reinforcement Learning</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SVM/" rel="tag">SVM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Supervised-Learning/" rel="tag">Supervised Learning</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Theoretical-Computer-Science/" rel="tag">Theoretical Computer Science</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tool/" rel="tag">Tool</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Unsupervised-Learning/" rel="tag">Unsupervised Learning</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Attention-Mechanism/" style="font-size: 11.82px;">Attention Mechanism</a> <a href="/tags/CNN/" style="font-size: 12.73px;">CNN</a> <a href="/tags/Configuration/" style="font-size: 10px;">Configuration</a> <a href="/tags/Data-Analysis/" style="font-size: 10px;">Data Analysis</a> <a href="/tags/Dataset-Distillation/" style="font-size: 13.64px;">Dataset Distillation</a> <a href="/tags/Decision-Trees/" style="font-size: 10px;">Decision Trees</a> <a href="/tags/Deep-Learning/" style="font-size: 20px;">Deep Learning</a> <a href="/tags/GCN/" style="font-size: 11.82px;">GCN</a> <a href="/tags/GNN/" style="font-size: 15.45px;">GNN</a> <a href="/tags/Generative-AI/" style="font-size: 10.91px;">Generative AI</a> <a href="/tags/Hexo/" style="font-size: 10.91px;">Hexo</a> <a href="/tags/Lab/" style="font-size: 10.91px;">Lab</a> <a href="/tags/Linux/" style="font-size: 16.36px;">Linux</a> <a href="/tags/Machine-Learning/" style="font-size: 17.27px;">Machine Learning</a> <a href="/tags/Markup-Language/" style="font-size: 10px;">Markup Language</a> <a href="/tags/Math/" style="font-size: 19.09px;">Math</a> <a href="/tags/Paper/" style="font-size: 14.55px;">Paper</a> <a href="/tags/Python/" style="font-size: 18.18px;">Python</a> <a href="/tags/RNN/" style="font-size: 10.91px;">RNN</a> <a href="/tags/Recommender-System/" style="font-size: 10.91px;">Recommender System</a> <a href="/tags/Reinforcement-Learning/" style="font-size: 10.91px;">Reinforcement Learning</a> <a href="/tags/SVM/" style="font-size: 10px;">SVM</a> <a href="/tags/Supervised-Learning/" style="font-size: 11.82px;">Supervised Learning</a> <a href="/tags/Theoretical-Computer-Science/" style="font-size: 15.45px;">Theoretical Computer Science</a> <a href="/tags/Tool/" style="font-size: 18.18px;">Tool</a> <a href="/tags/Unsupervised-Learning/" style="font-size: 11.82px;">Unsupervised Learning</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/06/">June 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/01/">January 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">December 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">November 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/10/">October 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/09/">September 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/08/">August 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/07/">July 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/06/">June 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">May 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">April 2023</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/06/17/Diffusion/">Diffusion</a>
          </li>
        
          <li>
            <a href="/2024/01/20/VAE/">VAE</a>
          </li>
        
          <li>
            <a href="/2023/12/02/CountingComplexity/">Computational Complexity: Complexity of Counting</a>
          </li>
        
          <li>
            <a href="/2023/11/24/MatrixTheory5/">MatrixTheory: 特殊矩阵与矩阵分解</a>
          </li>
        
          <li>
            <a href="/2023/11/13/RandomizedComputation/">Computational Complexity: Randomized Computation</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 ChaosTsang<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/" class="mobile-nav-link">home</a>
  
    <a href="/about/" class="mobile-nav-link">about</a>
  
    <a href="/tags/" class="mobile-nav-link">tags</a>
  
    <a href="/categories/" class="mobile-nav-link">categories</a>
  
    <a href="/archives/" class="mobile-nav-link">archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>





<script src="/js/script.js"></script>





  </div>
</body>
</html>